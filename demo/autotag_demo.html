<html>
<head>
  <!-- IE11 does support addEventListener(). Disable compatibility mode. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="../js/jquery-autotag-1.4.js"></script>
  <script src="../js/URI.js"></script>
  <link rel="stylesheet" type="text/css" href="../css/jquery-autotag.css">

  <!-- The styles below are for the demo only. -->
  <style type="text/css">

    body {
      background-color: #EEE;
      font-family: Arial, Helvetica, sans-serif;
    }
    .demos {
        display: flex;
        display: -webkit-flex;
        flex-flow: row wrap;
        align-items: center;
        justify-content: space-around;
    }
    .demo {
        width: 400px;
    }
    .instructions {
        text-align: center;
        padding: 10px;
        box-sizing: border-box;
        height: 80px;
        vertical-align: bottom;
        display: table-cell;
        width: 400px;
        font-size: 0.9em;
        color: #555;
    }
    .autotag-area {
        box-sizing: border-box;
        background-color: #FFF;
        border: 1px solid #DDD;
        border-radius: 5px;
        height: auto;
        padding: 20px;
        min-height: 100px;
    }

    .autotag-area:focus > a:hover {
        color: blue;
    }

  </style>
</head>
<body>
  <div class="demos">
      <div class="demo">
        <div class="instructions">
          Type some text into the boxes below. <br/>
          You can use <strong>#</strong> and <strong>@</strong> before a word
          and see it change color.
        </div>
        <!--
          Use this div as an editable area. In practice, you would probably want to
          save the contents into a textarea that is hidden, prior to POST.
         -->
        <div id="demo-1-snippet" class="autotag-area" contentEditable="true"></div>
      </div>

      <div class="demo">
        <div class="instructions">
            <b>Demo 2</b> uses a custom tokenizer and decorator. <br/>
            The tokenizer recognises strings that begin with '+' and
            decorates the following string.
        </div>
        <div id="demo-2-snippet" class="autotag-area" contentEditable="true"></div>
      </div>

      <div class="demo">
        <div class="instructions">
            <b>Demo 3</b> Highlight valid links. <br/>
            Active links are colored green, inactive in red.
            Invalid formatted links are left as is.
        </div>
        <div id="demo-3-snippet" class="autotag-area" contentEditable="true"></div>
      </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function(){
        ///////////////////// DEMO 1 //////////////////////////
        // By default, the plugin does not set focus on the editable element.
        // You can either uncomment the line in plugin or just call focus().
        $('#demo-1-snippet').autotag().focus();

        ///////////////////// DEMO 2 //////////////////////////
        // Configure a custom tokenizer that recognizes
        // strings that begin with a + sign. The custom decorator changes
        // the text color to white on a black background.
        var demo_2_config = {
            decorator: function(node) {
                var text = node.firstChild.nodeValue;
                if (text.match(/^[\+][\w]+/)) {
                    var style = "\
                        color: brown;\
                        background-color: lightyellow;\
                        border: 1px solid yellow;\
                        border-radius: 3px;\
                        padding: 1px 4px;\
                        font-size: 0.8em;\
                    ";
                    node.setAttribute('style', style);
                } else {
                    // Always remember to clean the node!
                    node.removeAttribute('style');
                }
                return node;
            },
            tokenizer: function(str) {
                return str.split(/(\B[^,;\.\w]\b\w+(?=\W*))/ig);
            }
        };
        $('#demo-2-snippet').autotag(demo_2_config);


        ///////////////////// DEMO 3 //////////////////////////
        // Using a custom tokenizer and decorator, that recognizes
        // url fragments and automatically links them. Note that adding
        // the links as href is only for visually depicting that it is
        // a valid link. Ideally you would want to extract the string
        // and do the linking wherever this is presented on the page.
        var urls = {
            'google.com' : 'https://wwww.google.com',
            'yahoo.com' : 'https://www.yahoo.com',
            'bing.com' : 'https://www.bing.com'
        };

        var demo_3_config = {
            tokenizer: function(str) {
                return str.match(/\b(https?:\/\/)*[^\s]+(\.[^\s]+)+|[\s]*[^\s]*[\s]*/ig);
            },
            decorator: function(node) {
                var text = node.firstChild.nodeValue;
                Object.keys(urls).some(function(key, index){
                    if (text.toLowerCase().indexOf(key) !== -1) {
                        node.setAttribute('style', 'color:blue');
                        node.setAttribute('href', urls[key]);
                        node.setAttribute('title', urls[key]);
                        // Break out of the loop.
                        return true;
                    } else {
                        // Always remember to clean the node!
                        node.removeAttribute('style');
                        node.removeAttribute('href');
                        node.removeAttribute('title');
                    }
                });
            },
            trace: true
        };

        $('#demo-3-snippet').autotag(demo_3_config);
    });
  </script>
</body>
</html>
