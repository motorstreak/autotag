/*
 autotagjs.js v1.5 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function A(d,g){return"undefined"===typeof d||null==d?g:d}function H(d,g){d&&d.nodeType==Node.ELEMENT_NODE&&d.setAttribute("style",g)}function U(d,g){for(var h=0,k;k=d[h];h++)g.appendChild(k)}function t(d,g){return d&&d.classList&&d.classList.contains(g)}function u(d,g){var h=document.createElement(d);g&&(h.className=g);return h}function y(d){return d&&d.parentNode.removeChild(d)}function W(d,g){for(var h=0,k;k=d[h];h++)g&&!g(k)||y(k)}function I(d){for(;d&&d.hasChildNodes();)d.removeChild(d.lastChild)}
function k(d){return d&&d.nodeType==Node.TEXT_NODE}function J(){var d;if("undefined"!=typeof window.getSelection){var g=window.getSelection();g.rangeCount&&(d=g.getRangeAt(0))}else(g=document.selection)&&"Control"!=g.type&&(d=g.createRange());return d}function K(d){if(d)if(window.getSelection){var g=window.getSelection();0<g.rangeCount&&g.removeAllRanges();g.addRange(d)}else document.createRange?window.getSelection().addRange(d):document.selection&&d.select()}function X(d){var g,h="",k={M:1E3,CM:900,
D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};for(g in k)for(;d>=k[g];)h+=g,d-=k[g];return h}String.prototype.splice||(String.prototype.splice=function(d,g,h){return this.slice(0,d)+h+this.slice(d+Math.abs(g))});var p=Object.freeze({BLANK:0,INDENT:1,OUTDENT:2}),na={styles:"disc circle square white-square diamond white-diamond".split(" ")},oa=Object.freeze({66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"});return function(d,g){var h,V,L="";g=g||{};var pa=g.ignoreReturnKey||
!1,qa=g.decorator||function(a,c){},ra=g.splitter||function(a){a=a.textContent;if(a.match(/(.+[ !?\.])|([ !?\.].)/))return a.length-1},sa=g.afterSelection||function(a){},ta=g.onMenuClick||function(){},Y=function(a,c){if(Array.isArray(a))for(var b=0,f;f=a[b];b++)Y(f,c);else for(b=0;f=c[b];b++)switch(f=f.split(/ +/),f[0]){case "indent":x(a,B(!0),["margin-left:35px"]);break;case "outdent":x(a,B(!1),["margin-left:35px"]);break;case "list":M(a,!0,f[1])}},x=function(a,c,b){if(Array.isArray(a))for(var f=
0,e;e=a[f];f++)x(e,c,b);else for(a=k(a)?a.parentNode:a,f=0;f<b.length;f++){var d=b[f].split(/\s*:\s*/);e=d[0];var g=d[1];d=a.style;var h=d.getPropertyValue(e);if(0<h.length&&c.match(/^atg(Unset|Toggle)/))d.removeProperty(e);else if(c.match(/^atg(Set|Initialize|Toggle)/))d.setProperty(e,g);else if(c.match(/^atg(Increment|Decrement)/)){h=h||getComputedStyle(a).getPropertyValue(e);g=Z(g);h=Z(h);switch(c){case "atgIncrement":h+=g;break;case "atgDecrement":h-=g}0>=h?d.removeProperty(e):d.setProperty(e,
h+"px")}}},N=function(a,c,b,f,e){b="hsla("+c+", "+b+"%, "+f+"%, 1.0)";c=u("div","atg-palette-cell");c.style.background=b;c.dataset.atgPaletteColor=b;if("highlight"===e){e=c.dataset;b=c.style.background.match(/[.?\d]+/g);for(f=0;3>f;f++)b[f]/=255,b[f]=.03928>=b[f]?b[f]/12.92:Math.pow((b[f]+.055)/1.055,2.4);e.atgPaletteContrastColor=.179<.2126*b[0]+.7152*b[1]+.0722*b[2]?"#000":"#FFF"}return a.appendChild(c)},E=function(a,c){c=c||{};var b=u("div","atg-line"),f=u("div","atg-line-body");b.appendChild(f);
b.dataset.atgIndentPos=0;if(a){switch(c.attachAs){case "child":a.appendChild(b);break;case "next-sibling":a.parentNode.insertBefore(b,a.nextSibling);break;case "previous-sibling":a.parentNode.insertBefore(b,a);break;default:a.parentNode.insertBefore(b,a.nextSibling)}"child"!==c.attachAs&&q(a)&&(b.dataset.atgIndentPos=a.dataset.atgIndentPos);c.addPilotNode&&aa(f,c.setCaret)}return b},aa=function(a,c){I(a);var b=v(ba("\u00a0")),f=b.parentNode;a.appendChild(f);H(f,L);f.classList.add("atg-pilot");c&&
m(b,0)},v=function(a,c,b){if(k(a)){if(!a.parentNode||O(a))c=u("span",c),H(c,b||L),c.classList.add("atg-text"),a.parentNode&&a.parentNode.insertBefore(c,a),c.appendChild(a);return a}},ba=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},ca=function(a){a=A(a,J());a.collapsed&&m(a.endContainer,a.endOffset)},P=function(){if(0==d.children.length)return E(d,{attachAs:"child",addPilotNode:!0,setCaret:!0})},ea=function(a,c){if(h&&a&&(!h.collapsed||n(h.endContainer))){switch(c){case "line":var b=
C(h,NodeFilter.SHOW_ELEMENT,l);break;default:b=da(h)}b=b||[];b=b.filter(Boolean);for(var f in a)if(a.hasOwnProperty(f)){var e=b,d=f,g=a[f].split(/\s*;\s*/);"atgCommand"==d?Y(e,g):"atgCallback"==d?ta(g,e):x(e,d,g)}K(h)}},z=function(a){l(a)||(a=w(a));return a.querySelector(".atg-line-body")},fa=function(a){l(a)||(a=w(a));return a.querySelector(".atg-line-leader")},w=function(a){if(a&&a.isSameNode(d))return d.querySelector("div:first-child");for(;a&&!l(a);)a=a.parentNode;return a},F=function(a){a=l(a)?
a:w(a);return ha(ia(z(a),NodeFilter.SHOW_TEXT),k)},ha=function(a,c,b){var f=[];do{var e=a.currentNode;c&&!c(e)||f.push(e)}while(a.nextNode()&&(!b||f.length<=b));return f},C=function(a,c,b){return ha(va(a,c,b),b)},Z=function(a){return parseInt(a&&a.match(/^[-+]?\d*\.?\d+/)[0]||0)},va=function(a,c,b){return ia(a.commonAncestorContainer,c,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(ua){c.selectNodeContents(b)}b=-1==a.compareBoundaryPoints(Range.END_TO_START,
c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})},ia=function(a,c,b){return document.createTreeWalker(a,c,{acceptNode:function(a){return!b||b(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1)},G=function(){for(var a=menubar.querySelectorAll(".atg-submenu"),c=0,b;b=a[c];c++)b.style.display="none"},l=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&t(a,"atg-line")},Q=function(a){return a&&k(a)&&(t(a.parentNode,"atg-line-body")||t(a.parentNode,"atg-text"))},R=function(a){return Q(a)&&
t(a.parentNode,"atg-text")},O=function(a){return Q(a)&&t(a.parentNode,"atg-line-body")},n=function(a){a=a&&a.textContent;return 0==a.length||1==a.length&&"\u00a0"==a},q=function(a){return l(a)&&"0"!==a.dataset.atgIndentPos},ja=function(a){for(var c=a;q(a.previousSibling);)a=a.previousSibling;if(q(a)){var b=[],f=0;do{var e=a.dataset.atgListId;if(isNaN(e)||0<e.length){e=parseInt(a.dataset.atgIndentPos);e>f&&(b[e-1]=0);b[e-1]+=1;f=e;for(e=0;e<b.length;e++)b[e]||(b[e]=1);a.dataset.atgListId=b.slice(0,
parseInt(f)).join(".")}var d=a;e=fa(d);e||(e=u("div","atg-line-leader"),e.setAttribute("contenteditable","false"),d.insertBefore(e,d.firstChild));var g=d.dataset.atgListId;if(null!==g){I(e);d=na;for(var h=d.suffix||"",k=d.seperator||"",m=[],n=g.split("."),p=d.styles.length,l=k?0:n.length-1;g=parseInt(n[l]);l++){var r=void 0;switch(d.styles[(p+l)%p]){case "decimal":r=g;break;case "lower-alpha":r=String.fromCharCode(97+(26+g-1)%26);break;case "upper-alpha":r=String.fromCharCode(65+(26+g-1)%26);break;
case "lower-roman":r=X(g).toLowerCase();break;case "upper-roman":r=X(g);break;case "disc":r="\u25cf";break;case "circle":r="\u25cb";break;case "square":r="\u25a0";break;case "white-square":r="\u25a1";break;case "diamond":r="\u25c6";break;case "white-diamond":r="\u25c7"}m.push(r)}d=m.join(k)+h;e.appendChild(ba(d))}}while(q(a.nextSibling)&&(a=a.nextSibling))}q(c)||(c=fa(c))&&y(c)},S=function(){var a=h.endContainer;k(a)&&O(a)&&(D(a,0),m(a));var c=a.textContent;c.match(RegExp("\u00a0"))&&(a.nodeValue=
a.textContent.replace(RegExp("\u00a0","g"),""),m(a),a.parentNode.classList.remove("atg-pilot"));var b=ra(a);b&&0<b&&b<c.length&&(a=D(a,b)[1],m(a));W(d.querySelectorAll("br"))},ka=function(){var a=J();if(a&&a!=h){var c=a.endContainer;k(a.startContainer)&&k(c)&&(h=a,R(c)&&(L=c.parentNode.getAttribute("style")),a.collapsed&&(qa(c.parentNode,c.textContent),1==a.endOffset&&n(c)&&m(c,0)));return h}},m=function(a,c){k(a)||(a=F(a).pop());if(a)return c=A(c,a.length),la({startContainer:a,startOffset:c,endContainer:a,
endOffset:c})},la=function(a){var c=a.startContainer,b=a.endContainer;if(c&&b){var f=A(a.startOffset,0);a=A(a.endOffset,b.length);var e=document.createRange();try{e.setStart(c,f),e.setEnd(b,a),h=e}catch(ua){}K(e)}return e},M=function(a,c,b){if(b=c==p.CLEAR)b=q(a)&&""===a.dataset.atgListId;b&&(c=p.OUTDENT);b=c==p.INDENT;var f=c==p.OUTDENT;c!==p.CLEAR&&x(a,B(b),["margin-left:25px"]);c=parseInt(a.dataset.atgIndentPos);b?a.dataset.atgIndentPos=c?c+1:1:f?c&&(a.dataset.atgIndentPos=c-1):a.dataset.atgListId=
"";ja(a)},B=function(a){return a?"atgIncrement":"atgDecrement"},ma=function(a,c,b){var f=a.startContainer,e=a.startOffset;b=c==p.INDENT;if(a.collapsed)if(a=w(f),T(f,e))if(q(a))M(a,c);else if(b)x(a,B(b),["margin-left:35px"]);else return!1;else if(b)k(f)&&(f.nodeValue=f.textContent.splice(e,0,"\t"),m(f,e+1)),S();else return!1;else for(f=C(a,NodeFilter.SHOW_ELEMENT,l),e=0;a=f[e];e++)q(a)?M(a,c):x(a,B(b),["margin-left:35px"]);return!0},T=function(a,c){var b=F(a).shift();return k(a)&&a.isSameNode(b)&&
(0==c||n(a.parentNode))},wa=function(a){for(var c=da(a),b=0,f;f=c[b];b++)R(f)&&(f=f.parentNode),y(f);W(C(a,NodeFilter.SHOW_ELEMENT,l),function(a){return n(a)||n(z(a))});P()},D=function(a,c){c=A(c,0);var b=F(w(a)),f=b.indexOf(a);if(k(a))if(0==c){var e=v(b[f-1]);var d=v(a)}else c==a.length?(e=v(a),d=v(b[f+1])):(e=v(a),d=a.splitText(c),v(y(d),null,e.parentNode.getAttribute("style")),b=e.parentNode,b.parentNode.insertBefore(d.parentNode,b.nextSibling));return[e,d]},da=function(a){if(a.collapsed)var c=
[a.startContainer];else{c=a.startContainer;var b=a.startOffset,f=a.endContainer;a=a.endOffset;var e=D(c,b)[1],d;c.isSameNode(f)&&(a-=b,f=e,c.length==a&&(d=e));d||(d=D(f,a)[0]);h=la({startContainer:e,startOffset:0,endContainer:d,endOffset:a});c=C(h,NodeFilter.SHOW_TEXT,Q)}for(b=0;a=c[b];b++)O(a)&&(f=a.nextSibling,d=a.parentNode,a=v(a),d.insertBefore(a,f));return c};d.addEventListener("dblclick",function(a){ka()});d.addEventListener("click",function(a){G();P()});d.addEventListener("focus",function(a){G();
P()});d.addEventListener("input",function(){S()});d.addEventListener("keydown",function(a){var c=a.which||a.keyCode||0;8!=c&&ca();var b=J();if(8==c){if(b.collapsed){var f=b.startContainer,e=b.startOffset;c=w(f);if(!ma(b,p.CLEAR))if(n(f)||n(c)||T(f,e)){if(b=c.previousSibling,l(b)){b=z(b);f=z(c);if(n(f))m(b.lastChild);else{n(b)&&I(b);e=[];for(f=f.firstChild;f;)e.push(f),f=f.nextSibling;0<e.length&&U(e,b)}y(c)}}else{c=f;b=w(c);f=F(b);var d=f.indexOf(c);c.nodeValue=c.textContent.splice(e-1,1,"");n(b)?
aa(z(b),!0):n(c)?(y(c.parentNode),c=f[d-1],m(c)):m(c,e-1)}}else wa(b);a.preventDefault()}else if(9==c)ma(b,a.shiftKey?p.OUTDENT:p.INDENT),a.preventDefault();else if(13==c){if(!pa&&(c=a.shiftKey,e=b.startContainer,f=b.startOffset,ca(b),b.collapsed&&k(e))){b=w(e);d=e.parentNode;var g;if(g=k(e)){if(g=f==e.textContent.length)g=d&&d.nodeType==Node.ELEMENT_NODE&&t(d,"atg-line-body")||!d.nextSibling;g=g||n(d)}if(g)e=E(b,{addPilotNode:!0,setCaret:!0});else if(T(e,f))e=E(b,{attachAs:"previous-sibling",addPilotNode:!0,
setCaret:!1});else{f=D(e,f)[1];e=E(b,{attachAs:"next-sibling"});d=f.parentNode;g=[];do g.push(d);while(d=d.nextSibling);U(g,z(e));m(f,0)}e.className=b.className;H(e,b.getAttribute("style"));q(e)&&c&&(e.dataset.atgListId="");ja(e)}a.preventDefault()}else!a.metaKey||66!=c&&73!=c&&85!=c?39==c&&n(b.endContainer)&&a.preventDefault():(ea({atgToggle:oa[c]}),a.preventDefault())});d.addEventListener("keyup",function(a){});d.addEventListener("copy",function(a){});d.addEventListener("paste",function(a){var c,
b=h.endContainer;a.clipboardData?c=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(c=window.clipboardData.getData("Text"));k(b)?(b.nodeValue+=c,m(b)):(c=document.createTextNode(c),b.insertBefore(c,b.firstChild),m(c));S();a.preventDefault()});document.addEventListener("selectionchange",function(a){ka()&&sa(C(h,NodeFilter.SHOW_TEXT,R))});return{attachMenubar:function(a){a&&(V=a,V.addEventListener("click",function(a){G();K(h);a=a.target;var b;a:for(b=a;b&&!t(b,"atg-submenu")&&
!t(b,"atg-menu");)if((b=b.parentNode)&&b.isSameNode(d)){b=void 0;break a}if(b){var c=b.querySelector(".atg-submenu");if(c){var e=window.getComputedStyle(c);c.style.display="none"===e.display?"":"none"}else if(b.dataset.atgSubmenu){if(b.dataset.atgSubmenu.match(/Palette$/)){if(e=b.getElementsByClassName("atg-submenu")[0])e.style.display="";else{e=u("div","atg-submenu atg-palette");a=b.dataset.atgSubmenu.split("Palette")[0];e.dataset.atgPalette=a;e.dataset.atgScope=b.dataset.atgScope;b.appendChild(e);
var g=Math.round(36),k=Math.round(2);c=Math.round(18);for(var m=0,n=100,l=94;5>m;m++,n-=k,l-=c){b=e.appendChild(u("div","atg-palette-row"));for(var p=0,q=0;10>p;p++,q+=g)N(b,q,n,l,a)}b=e.appendChild(u("div","atg-palette-row"));c=Math.round(100/9);g=0;for(l=c;9>g;g++,l+=c)N(b,0,0,l,a);b=N(b,0,0,100);b.classList.add("atg-crossed-cell");"color"===a&&(b.dataset.atgPaletteColor="#000")}_activeSubmenu=e}}else b.dataset.atgPalette&&(c=b.dataset.atgPalette,l=a.dataset,l.atgSet||(g=l.atgPaletteColor,"color"===
c?e="color: "+g:"highlight"===c&&(e="background-color: "+g),l.atgSet=e)),ea(a.dataset,b.dataset.atgScope),G()}}))}}}}();
