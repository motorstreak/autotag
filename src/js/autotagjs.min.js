/*
 autotagjs.js v1.5 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function w(f,e){return"undefined"===typeof f||null==f?e:f}function J(f,e){return e.parentNode.insertBefore(f,e.nextSibling)}function Q(f,e){f&&f.nodeType==Node.ELEMENT_NODE&&e&&e.length&&f.setAttribute("style",e)}function Z(f,e){for(var k=0,h;h=f[k];k++)e.appendChild(h)}function x(f,e){return f&&f.classList&&f.classList.contains(e)}function y(f,e){var k=document.createElement(f);e&&(k.className=e);return k}function z(f){return f&&f.parentNode.removeChild(f)}function aa(f,
e){for(var k=0,h;h=f[k];k++)e&&!e(h)||z(h)}function ba(f){for(;f&&f.hasChildNodes();)f.removeChild(f.lastChild)}function u(f){return f&&f.nodeType==Node.TEXT_NODE}function va(f,e){var k=[];for(f=f.firstChild;f;)e&&!e(f)||k.push(f),f=f.nextSibling;return k}function q(){var f;if("undefined"!=typeof window.getSelection){var e=window.getSelection();e.rangeCount&&(f=e.getRangeAt(0))}else(e=document.selection)&&"Control"!=e.type&&(f=e.createRange());return f}function ca(f){if(f)if(window.getSelection){var e=
window.getSelection();0<e.rangeCount&&e.removeAllRanges();e.addRange(f)}else document.createRange?window.getSelection().addRange(f):document.selection&&f.select()}function da(f){var e,k="",h={M:1E3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};for(e in h)for(;f>=h[e];)k+=e,f-=h[e];return k}String.prototype.splice||(String.prototype.splice=function(f,e,k){return this.slice(0,f)+k+this.slice(f+Math.abs(e))});var h=Object.freeze({CLEAR_LIST:0,INCREASE:1,DECREASE:2}),F=Object.freeze({START_TO_END:1,
END_TO_START:-1}),wa={"numbered-period":{styles:["decimal","lower-alpha","lower-roman"],suffix:"."},"numbered-bracket":{styles:["decimal","lower-alpha","lower-roman"],suffix:")"},"numbered-collated":{styles:["decimal"],suffix:". ",seperator:"."},bulletted:{styles:"disc circle square white-square diamond white-diamond".split(" ")}},xa=Object.freeze({66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"});return function(f,e){var k,R,ea,S;e=e||{};var ya=e.ignoreReturnKey||!1,za=
e.decorator||function(a){},Aa=e.splitter||function(a){},Ba=e.afterSelection||function(a){},Ca=e.onMenuClick||function(){},fa=function(a,c){if(Array.isArray(a))for(var b=0,d;d=a[b];b++)fa(d,c);else for(b=0;d=c[b];b++)switch(d=d.split(/ +/),d[0]){case "indent":d=a;var g=h.INCREASE;p(d)?A(d,g):G(d,g);break;case "outdent":d=a;g=h.DECREASE;p(d)?A(d,g):G(d,g);break;case "list":A(a,h.INCREASE,d[1])}},K=function(a,c,b){if(Array.isArray(a))for(var d=0,g;g=a[d];d++)K(g,c,b);else for(a=u(a)?a.parentNode:a,d=
0;d<b.length;d++){var l=b[d].split(/\s*:\s*/);g=l[0];var f=l[1];l=a.style;var e=l.getPropertyValue(g);if(0<e.length&&c.match(/^atg(Unset|Toggle)/))l.removeProperty(g);else if(c.match(/^atg(Set|Initialize|Toggle)/))l.setProperty(g,f);else if(c.match(/^atg(Increment|Decrement)/)){e=e||getComputedStyle(a).getPropertyValue(g);f=ha(f);e=ha(e);switch(c){case "atgIncrement":e+=f;break;case "atgDecrement":e-=f}0>=e?l.removeProperty(g):l.setProperty(g,e+"px")}}},T=function(a,c,b,d,g){b="hsla("+c+", "+b+"%, "+
d+"%, 1.0)";c=y("div","atg-palette-cell");c.style.background=b;c.dataset.atgPaletteColor=b;if("highlight"===g){g=c.dataset;b=c.style.background.match(/[.?\d]+/g);for(d=0;3>d;d++)b[d]/=255,b[d]=.03928>=b[d]?b[d]/12.92:Math.pow((b[d]+.055)/1.055,2.4);g.atgPaletteContrastColor=.179<.2126*b[0]+.7152*b[1]+.0722*b[2]?"#000":"#FFF"}return a.appendChild(c)},ia=function(a,c){var b=y("p","atg-line-body");b.setAttribute("contenteditable",!0);a.appendChild(b);c.addPilotNode&&U(b,c.setCaret)},B=function(a,c){c=
c||{};var b=y("p","atg-line");b.setAttribute("contenteditable",!0);b.dataset.atgIndentPos=0;if(a){switch(c.attachAs){case "child":a.appendChild(b);break;case "next-sibling":J(b,a);break;case "previous-sibling":a.parentNode.insertBefore(b,a);break;default:J(b,a)}"child"!==c.attachAs&&p(a)&&(b.dataset.atgIndentPos=a.dataset.atgIndentPos);ia(b,c)}return b},U=function(a,c){a=m(a)?t(a):a;ba(a);var b=v(V("\u200b\u200b")),d=b.parentNode;a.appendChild(d);d.classList.add("atg-bol");Q(d,"");c&&n(b,2)},v=function(a,
c,b){if(u(a)){if(!a.parentNode||W(a))c=y("span",c),c.classList.add("atg-text"),Q(c,b||""),a.parentNode&&a.parentNode.insertBefore(c,a),c.appendChild(a);return a}},V=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},L=function(a){a=w(a,q());if(a.collapsed){var c=a.endContainer;a=a.endOffset;H(c.parentNode)&&2>a&&(a=2);n(c,a)}},X=function(){if(0==f.textContent.length)return B(f,{attachAs:"child",addPilotNode:!0,setCaret:!0})},ka=function(a,c){if(a){var b=q();switch(c){case "line":b=
I(b,NodeFilter.SHOW_ELEMENT,m);break;default:b=ja(b)}b=b||[];b=b.filter(Boolean);for(var d in a)if(a.hasOwnProperty(d)){var g=b,l=d,f=a[d].split(/\s*;\s*/);"atgCommand"==l?fa(g,f):"atgCallback"==l?Ca(f,g):K(g,l,f)}M({startContainer:b.shift(),endContainer:b.pop()})}},t=function(a){a&&!m(a)&&(a=r(a));return a&&a.querySelector(".atg-line-body")},N=function(a){a&&!m(a)&&(a=r(a));return a&&a.querySelector(".atg-line-leader")},r=function(a){if(a&&a.isSameNode(f))return f&&f.querySelector("p:first-child");
for(;a&&!m(a);)a=a.parentNode;return a},C=function(a){a=m(a)?a:r(a);return la(ma(t(a),NodeFilter.SHOW_TEXT),u)},la=function(a,c,b){var d=[];if(a){do{var g=a.currentNode;c&&!c(g)||d.push(g)}while(a.nextNode()&&(!b||d.length<=b))}return d},I=function(a,c,b){return la(Da(a,c,b),b)},ha=function(a){return parseInt(a&&a.match(/^[-+]?\d*\.?\d+/)[0]||0)},Da=function(a,c,b){if(a){b=b||D;for(var d=a.commonAncestorContainer;!(!d||b(d)||d&&d.isSameNode(f)||d&&d.nodeType==Node.DOCUMENT_NODE);)d=d.parentNode;return ma(d,
c,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(Ga){c.selectNodeContents(b)}b=-1==a.compareBoundaryPoints(Range.END_TO_START,c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})}},ma=function(a,c,b){return document.createTreeWalker(a,c,{acceptNode:function(a){return!b||b(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1)},O=function(){for(var a=menubar.querySelectorAll(".atg-submenu"),c=0,b;b=a[c];c++)b.style.display=
"none"},m=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&x(a,"atg-line")},Y=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&x(a,"atg-line-body")},D=function(a){return a&&u(a)&&(Y(a.parentNode)||Y(a.parentNode.parentNode))},na=function(a){var c;if(c=D(a))c=(a=a.parentNode)&&x(a,"atg-text");return c},W=function(a){return D(a)&&Y(a.parentNode)},H=function(a){return a&&x(a,"atg-text")&&x(a,"atg-bol")},p=function(a){return m(a)&&"0"!==a.dataset.atgIndentPos},oa=function(a,c){for(var b=a,d=a;p(d.previousSibling);)d=
d.previousSibling;a=d;if(p(a)){d=[];var g=0;do{var l=a.dataset.atgListId;if(isNaN(l)||0<l.length){l=parseInt(a.dataset.atgIndentPos);l>g&&(d[l-1]=0);d[l-1]+=1;g=l;for(l=0;l<d.length;l++)d[l]||(d[l]=1);a.dataset.atgListId=d.slice(0,parseInt(g)).join(".")}var f=a,e=c;l=N(f);l||(l=y("p","atg-line-leader"),l.setAttribute("contenteditable","false"),f.insertBefore(l,f.firstChild));e=e||l.dataset.atgListType;l.dataset.atgListType=e;var k=f.dataset.atgListId;if(null!==k){ba(l);var h;e=wa[e];if(0==k.length)e=
"";else{f=e.suffix||"";var q=e.seperator||"",n=[];k=k.split(".");for(var r=e.styles.length,m=q?0:k.length-1;h=parseInt(k[m]);m++){switch(e.styles[(r+m)%r]){case "lower-alpha":h=String.fromCharCode(97+(26+h-1)%26);break;case "upper-alpha":h=String.fromCharCode(65+(26+h-1)%26);break;case "lower-roman":h=da(h).toLowerCase();break;case "upper-roman":h=da(h);break;case "disc":h="\u25cf";break;case "circle":h="\u25cb";break;case "square":h="\u25a0";break;case "white-square":h="\u25a1";break;case "diamond":h=
"\u25c6";break;case "white-diamond":h="\u25c7"}n.push(h)}e=n.join(q)+f}l.appendChild(V(e))}}while(p(a.nextSibling)&&(a=a.nextSibling))}b&&!p(b)&&(b=N(b))&&z(b)},P=function(a,c,b){if(D(a)){c%=2;if(0==c)return a;if(b=w(b,!0)){b=r(a);var d=C(b);a=d.indexOf(a);return 0===a&&-1===c?(c=b.previousElementSibling)&&C(c).pop():a===d.length-1&&1===c?(c=b.nextElementSibling)&&C(c).shift():d[a+c]}a=a.parentNode;return(c=1===c?a.nextSibling:a.previousSibling)&&c.firstChild}},qa=function(){var a=q().endContainer;
u(a)&&W(a)&&(E(a,0),n(a));pa(a)},pa=function(a){var c;var b=(c=a.textContent.match(/(^\u200b{2}(?=.))|(\w+(?=\W)|\W+(?=\w))/))?c[0].length:void 0;isNaN(b)||(a=E(a,b,!0).pop(),pa(a),n(a,1),L())},sa=function(a,c){var b=a.startContainer,d=a.startOffset;L(a);if(a.collapsed&&u(b)){var g=r(b);if(H(b))return B(g,{addPilotNode:!0,setCaret:!0});if(D(b)&&d==b.textContent.length&&!P(b,1,!1))b=B(g,{addPilotNode:!0,setCaret:!0});else if(ra(b,d))b=B(g,{attachAs:"previous-sibling",addPilotNode:!0,setCaret:!1});
else{d=E(b,d)[1];b=B(g,{addPilotNode:!0});var f=[],e=d.parentNode;do f.push(e);while(e=e.nextSibling);Z(f,t(b));n(d,0)}b.className=g.className;Q(b,g.getAttribute("style"));p(b)&&c&&(b.dataset.atgListId="");if(p(g))var h=N(g).dataset.atgListType;oa(b,h)}},n=function(a,c){a&&!u(a)&&(a=C(a).pop());if(a)return c=w(c,a.length),M({startContainer:a,startOffset:c,endContainer:a,endOffset:c})},M=function(a){var c=a.startContainer,b=a.endContainer;if(c&&b){var d=w(a.startOffset,0),g=w(a.endOffset,b.length);
a=document.createRange();try{a.setStart(c,d),a.setEnd(b,g)}catch(l){}ca(a)}return q()},A=function(a,c,b){var d;if(d=c==h.CLEAR_LIST)d=p(a)&&""===a.dataset.atgListId;d&&(c=h.DECREASE);c!==h.CLEAR_LIST&&K(a,ta(c),["margin-left:25px"]);d=parseInt(a.dataset.atgIndentPos);c==h.INCREASE?a.dataset.atgIndentPos=d?d+1:1:c==h.DECREASE?d&&(a.dataset.atgIndentPos=d-1):a.dataset.atgListId="";oa(a,b)},G=function(a,c){K(a,ta(c),["margin-left:35px"])},ta=function(a){return a==h.INCREASE?"atgIncrement":"atgDecrement"},
ua=function(a){return"0px"!==window.getComputedStyle(r(a),null).getPropertyValue("margin-left")},ra=function(a,c){a=0==c?P(a,-1,!1):a;return H(a.parentNode)},Ea=function(a){var c=a.previousElementSibling,b=t(a);if(m(c)){c=t(c);var d=c.lastChild;b=va(b);b.shift();Z(b,c);setTimeout(function(){z(a);n(d.firstChild);d.focus();d.click()},0)}else U(b,!0)},Fa=function(a){for(var c=ja(a),b=P(c[0],-1)||P(c[c.length-1],1),d=0,g;g=c[d];d++)na(g)&&(g=g.parentNode),z(g);b&&n(b);aa(I(a,NodeFilter.SHOW_ELEMENT,m),
function(a){var b;(b=a&&0==a.textContent.length)||(b=(a=t(a))&&0==a.textContent.length);return b});X()},E=function(a,c,b){c=w(c,0);var d=C(r(a)),g=d.indexOf(a);if(u(a))if(0==c){var f=v(d[g-1]);var e=v(a)}else c==a.length?(f=v(a),e=v(d[g+1])):(f=v(a),e=a.splitText(c),v(z(e),null,f.parentNode.getAttribute("style")),J(e.parentNode,f.parentNode));b&&za([f,e]);return[f,e]},ja=function(a){if(a.collapsed)var c=[a.startContainer];else{c=a.startContainer;var b=a.startOffset,d=a.endContainer;a=a.endOffset;
var f=E(c,b)[1],e;c.isSameNode(d)&&(a-=b,d=f,c.length==a&&(e=f));e||(e=E(d,a)[0]);c=M({startContainer:f,startOffset:0,endContainer:e,endOffset:a});c=I(c,NodeFilter.SHOW_TEXT,D)}for(b=0;a=c[b];b++)W(a)&&(d=a.nextSibling,e=a.parentNode,a=v(a),e.insertBefore(a,d));return c};f.addEventListener("dblclick",function(a){});f.addEventListener("click",function(a){O();X();L()});f.addEventListener("focus",function(a){O()});f.addEventListener("input",function(a){if("deleteContentBackward"==a.inputType||8==k){aa(f.querySelectorAll("br"));
var c=q(),b=c.endContainer,d=b.parentNode;var g=w(void 0,q());g=r(g.startContainer,!1);H(d)&&1==c.endOffset?(t(g).firstChild.firstChild.nodeValue="\u200b\u200b",n(d.firstChild),p(g)?A(g,h.CLEAR_LIST):ua(g)?G(g,h.DECREASE):Ea(g),a.preventDefault()):0==c.endOffset&&b&&x(b,"atg-text")?(n(b.previousSibling.firstChild),z(b)):(a=t(g),(c=t(a))&&2>=c.textContent.length?U(a):N(g)&&null==a?ia(g,{addPilotNode:!0}):X())}else qa()});f.addEventListener("keydown",function(a){k=a.which||a.keyCode||0;8!=k&&L();var c=
q();if(c&&8!=k)if(9==k){var b=a.shiftKey?h.DECREASE:h.INCREASE,d=c.startContainer,f=c.startOffset,e=b==h.INCREASE;if(c.collapsed)c=r(d),ra(d,f)?p(c)?A(c,b):(e||ua(c))&&G(c,b):e&&(u(d)&&(d.nodeValue=d.textContent.splice(f,0,"\t"),n(d,f+1)),qa());else for(d=I(c,NodeFilter.SHOW_ELEMENT,m),f=0;c=d[f];f++)p(c)?A(c,b):G(c,h.INCREASE);a.preventDefault()}else 13==k?(ya||sa(c,a.shiftKey),a.preventDefault()):!a.metaKey||66!=k&&73!=k&&85!=k?39==k?(b=c.endContainer.textContent,c.endOffset<b.length&&"\u200b"===
b[c.endOffset]&&a.preventDefault()):37==k?2==c.endOffset&&H(c.endContainer.parentNode)&&a.preventDefault():ea=q().endContainer:(ka({atgToggle:xa[k]}),a.preventDefault())});f.addEventListener("keyup",function(a){var c=q();a=c.endContainer;if(a.isSameNode(ea)){var b=r(a);if(b=38==k&&b.previousSibling||40==k&&b.nextSibling||null){var d=38==k?F.END_TO_START:40==k?F.START_TO_END:F.END_TO_START;c=c.endOffset;a=a.parentNode;var f=a.getBoundingClientRect();a=f.left+(f.right-f.left)/a.textContent.length*c;
a:{d=w(d,F.START_TO_END);b=t(b);if(d==F.START_TO_END)var e=b.firstChild;else{for(b=b.lastChild.firstChild.parentNode;(e=b.previousSibling)&&e.offsetLeft<=b.offsetLeft;)b=e;e=b}do{b=e.getBoundingClientRect();if(b.right>a){e=[e.firstChild,Math.round((a-b.left)/((b.right-b.left)/e.textContent.length))];break a}b=e}while(e=e.nextSibling);e=[b.firstChild,b.textContent.length]}n(e[0],e[1])}}});f.addEventListener("copy",function(a){});f.addEventListener("paste",function(a){var c=q();c.collapsed||(Fa(c),
c=q());var b,d=c.endContainer,f=r(d);a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));var e=1E4>b.length;b=b.split("\n");1<b.length&&sa(c);c=d;for(var h=0;h<b.length;h++){var k=b[h];if(0<k.length){k=v(V(k));J(k.parentNode,c.parentNode);var m=1,n=k.textContent,p=n.length;do{var t=Aa(n.slice(0,m));isNaN(t)?m+=1:(k=E(k,t,!0).pop(),n=k.textContent,p=n.length,m=1)}while(m<=p&&e)}null!==b[h+1]&&(f=B(f,{addPilotNode:!0}),
c=C(f).shift())}M({startContainer:d,endContainer:c});a.preventDefault()});document.addEventListener("selectionchange",function(a){Ba(I(R,NodeFilter.SHOW_TEXT,na))});return{attachMenubar:function(a){a&&(S=a,S.addEventListener("mousedown",function(a){R=q();O();a=a.target;var b;a:for(b=a;b&&!x(b,"atg-submenu")&&!x(b,"atg-menu");)if((b=b.parentNode)&&b.isSameNode(f)){b=void 0;break a}if(b){var c=b.querySelector(".atg-submenu");if(c){var e=window.getComputedStyle(c);c.style.display="none"===e.display?
"":"none"}else if(b.dataset.atgSubmenu){if(b.dataset.atgSubmenu.match(/Palette$/)){if(e=b.getElementsByClassName("atg-submenu")[0])e.style.display="";else{e=y("div","atg-submenu atg-palette");a=b.dataset.atgSubmenu.split("Palette")[0];e.dataset.atgPalette=a;e.dataset.atgScope=b.dataset.atgScope;b.appendChild(e);c=18;for(var h=0,k=100,m=94;5>h;h++,k-=2,m-=c){b=e.appendChild(y("div","atg-palette-row"));for(var n=0,p=0;10>n;n++,p+=36)T(b,p,k,m,a)}b=e.appendChild(y("div","atg-palette-row"));c=Math.round(100/
9);h=0;for(m=c;9>h;h++,m+=c)T(b,0,0,m,a);b=T(b,0,0,100);b.classList.add("atg-crossed-cell");"color"===a&&(b.dataset.atgPaletteColor="#000")}_activeSubmenu=e}}else b.dataset.atgPalette&&(c=b.dataset.atgPalette,m=a.dataset,m.atgSet||(h=m.atgPaletteColor,"color"===c?e="color: "+h:"highlight"===c&&(e="background-color: "+h),m.atgSet=e)),ka(a.dataset,b.dataset.atgScope),O()}}),S.addEventListener("mouseup",function(a){ca(R)}))}}}}();
