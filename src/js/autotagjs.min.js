/*
 autotagjs.js v1.5 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function B(e,h){return"undefined"===typeof e||null==e?h:e}function H(e,h){return h.parentNode.insertBefore(e,h.nextSibling)}function O(e,h){e&&e.nodeType==Node.ELEMENT_NODE&&h&&h.length&&e.setAttribute("style",h)}function W(e,h){for(var C=0,k;k=e[C];C++)h.appendChild(k)}function D(e,h){return e&&e.classList&&e.classList.contains(h)}function v(e,h){var k=document.createElement(e);h&&(k.className=h);return k}function y(e){return e&&e.parentNode.removeChild(e)}function X(e,h){for(var k=
0,m;m=e[k];k++)h&&!h(m)||y(m)}function P(e){for(;e&&e.hasChildNodes();)e.removeChild(e.lastChild)}function m(e){return e&&e.nodeType==Node.TEXT_NODE}function w(){var e;if("undefined"!=typeof window.getSelection){var h=window.getSelection();h.rangeCount&&(e=h.getRangeAt(0))}else(h=document.selection)&&"Control"!=h.type&&(e=h.createRange());return e}function Y(e){var h,k="",m={M:1E3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};for(h in m)for(;e>=m[h];)k+=h,e-=m[h];return k}String.prototype.splice||
(String.prototype.splice=function(e,h,k){return this.slice(0,e)+k+this.slice(e+Math.abs(h))});var k=Object.freeze({CLEAR_LIST:0,INCREASE:1,DECREASE:2}),sa={"numbered-period":{styles:["decimal","lower-alpha","lower-roman"],suffix:"."},"numbered-bracket":{styles:["decimal","lower-alpha","lower-roman"],suffix:")"},"numbered-collated":{styles:["decimal"],suffix:". ",seperator:"."},bulletted:{styles:"disc circle square white-square diamond white-diamond".split(" ")}},ta=Object.freeze({66:"font-weight:bold",
73:"font-style:italic",85:"text-decoration:underline"});return function(e,h){var C;h=h||{};var ra=h.ignoreReturnKey||!1,ua=h.decorator||function(a){},Z=h.splitter||function(a){},va=h.afterSelection||function(a){},wa=h.onMenuClick||function(){},aa=function(a,c){if(Array.isArray(a))for(var b=0,d;d=a[b];b++)aa(d,c);else for(b=0;d=c[b];b++)switch(d=d.split(/ +/),d[0]){case "indent":d=a;var f=k.INCREASE;p(d)?E(d,f):I(d,f);break;case "outdent":d=a;f=k.DECREASE;p(d)?E(d,f):I(d,f);break;case "list":E(a,k.INCREASE,
d[1])}},J=function(a,c,b){if(Array.isArray(a))for(var d=0,f;f=a[d];d++)J(f,c,b);else for(a=m(a)?a.parentNode:a,d=0;d<b.length;d++){var g=b[d].split(/\s*:\s*/);f=g[0];var e=g[1];g=a.style;var h=g.getPropertyValue(f);if(0<h.length&&c.match(/^atg(Unset|Toggle)/))g.removeProperty(f);else if(c.match(/^atg(Set|Initialize|Toggle)/))g.setProperty(f,e);else if(c.match(/^atg(Increment|Decrement)/)){h=h||getComputedStyle(a).getPropertyValue(f);e=ba(e);h=ba(h);switch(c){case "atgIncrement":h+=e;break;case "atgDecrement":h-=
e}0>=h?g.removeProperty(f):g.setProperty(f,h+"px")}}},Q=function(a,c,b,d,f){b="hsla("+c+", "+b+"%, "+d+"%, 1.0)";c=v("div","atg-palette-cell");c.style.background=b;c.dataset.atgPaletteColor=b;if("highlight"===f){f=c.dataset;b=c.style.background.match(/[.?\d]+/g);for(d=0;3>d;d++)b[d]/=255,b[d]=.03928>=b[d]?b[d]/12.92:Math.pow((b[d]+.055)/1.055,2.4);f.atgPaletteContrastColor=.179<.2126*b[0]+.7152*b[1]+.0722*b[2]?"#000":"#FFF"}return a.appendChild(c)},F=function(a,c){c=c||{};var b=v("div","atg-line"),
d=v("div","atg-line-body");b.appendChild(d);b.dataset.atgIndentPos=0;if(a){switch(c.attachAs){case "child":a.appendChild(b);break;case "next-sibling":H(b,a);break;case "previous-sibling":a.parentNode.insertBefore(b,a);break;default:H(b,a)}"child"!==c.attachAs&&p(a)&&(b.dataset.atgIndentPos=a.dataset.atgIndentPos);c.addPilotNode&&ca(d,c.setCaret)}return b},ca=function(a,c){P(a);var b=t(R("\u00a0")),d=b.parentNode;a.appendChild(d);O(d,"");d.classList.add("atg-pilot");c&&n(b,0)},t=function(a,c,b){if(m(a)){if(!a.parentNode||
S(a))c=v("span",c),O(c,b||""),a.parentNode&&a.parentNode.insertBefore(c,a),c.appendChild(a);return a}},R=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},da=function(a){a=B(a,w());a.collapsed&&n(a.endContainer,a.endOffset)},T=function(){if(0==e.children.length)return F(e,{attachAs:"child",addPilotNode:!0,setCaret:!0})},fa=function(a,c){if(a){var b=w();switch(c){case "line":b=G(b,NodeFilter.SHOW_ELEMENT,u);break;default:b=ea(b)}b=b||[];b=b.filter(Boolean);for(var d in a)if(a.hasOwnProperty(d)){var f=
b,g=d,e=a[d].split(/\s*;\s*/);"atgCommand"==g?aa(f,e):"atgCallback"==g?wa(e,f):J(f,g,e)}K({startContainer:b.shift(),endContainer:b.pop()})}},z=function(a){a&&!u(a)&&(a=q(a));return a&&a.querySelector(".atg-line-body")},U=function(a){a&&!u(a)&&(a=q(a));return a&&a.querySelector(".atg-line-leader")},q=function(a){if(a&&a.isSameNode(e))return e&&e.querySelector("div:first-child");for(;a&&!u(a);)a=a.parentNode;return a},x=function(a){a=u(a)?a:q(a);return ha(ia(z(a),NodeFilter.SHOW_TEXT),m)},ha=function(a,
c,b){var d=[];if(a){do{var f=a.currentNode;c&&!c(f)||d.push(f)}while(a.nextNode()&&(!b||d.length<=b))}return d},G=function(a,c,b){return ha(xa(a,c,b),b)},ba=function(a){return parseInt(a&&a.match(/^[-+]?\d*\.?\d+/)[0]||0)},xa=function(a,c,b){if(a){b=b||L;for(var d=a.commonAncestorContainer;!(!d||b(d)||d&&d.isSameNode(e)||d&&d.nodeType==Node.DOCUMENT_NODE);)d=d.parentNode;return ia(d,c,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(ya){c.selectNodeContents(b)}b=
-1==a.compareBoundaryPoints(Range.END_TO_START,c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})}},ia=function(a,c,b){return document.createTreeWalker(a,c,{acceptNode:function(a){return!b||b(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1)},M=function(){for(var a=menubar.querySelectorAll(".atg-submenu"),c=0,b;b=a[c];c++)b.style.display="none"},u=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&D(a,"atg-line")},N=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&D(a,
"atg-line-body")},L=function(a){return a&&m(a)&&(N(a.parentNode)||N(a.parentNode.parentNode))},ja=function(a){return L(a)&&!N(a.parentNode)},S=function(a){return L(a)&&D(a.parentNode,"atg-line-body")},r=function(a){a=a&&a.textContent;return 0==a.length||1==a.length&&"\u00a0"==a},p=function(a){return u(a)&&"0"!==a.dataset.atgIndentPos},ka=function(a,c){for(var b=a,d=a;p(d.previousSibling);)d=d.previousSibling;a=d;if(p(a)){d=[];var f=0;do{var g=a.dataset.atgListId;if(isNaN(g)||0<g.length){g=parseInt(a.dataset.atgIndentPos);
g>f&&(d[g-1]=0);d[g-1]+=1;f=g;for(g=0;g<d.length;g++)d[g]||(d[g]=1);a.dataset.atgListId=d.slice(0,parseInt(f)).join(".")}var e=a,h=c;g=U(e);g||(g=v("div","atg-line-leader"),g.setAttribute("contenteditable","false"),e.insertBefore(g,e.firstChild));h=h||g.dataset.atgListType;g.dataset.atgListType=h;var k=e.dataset.atgListId;if(null!==k){P(g);var l;h=sa[h];if(0==k.length)h="";else{e=h.suffix||"";var m=h.seperator||"",r=[];k=k.split(".");for(var n=h.styles.length,q=m?0:k.length-1;l=parseInt(k[q]);q++){switch(h.styles[(n+
q)%n]){case "lower-alpha":l=String.fromCharCode(97+(26+l-1)%26);break;case "upper-alpha":l=String.fromCharCode(65+(26+l-1)%26);break;case "lower-roman":l=Y(l).toLowerCase();break;case "upper-roman":l=Y(l);break;case "disc":l="\u25cf";break;case "circle":l="\u25cb";break;case "square":l="\u25a0";break;case "white-square":l="\u25a1";break;case "diamond":l="\u25c6";break;case "white-diamond":l="\u25c7"}r.push(l)}h=r.join(m)+e}g.appendChild(R(h))}}while(p(a.nextSibling)&&(a=a.nextSibling))}b&&!p(b)&&
(b=U(b))&&y(b)},la=function(a,c){c%=2;var b=q(a),d=x(b),f=d.indexOf(a);return 0===f&&-1===c?(b=b.previousElementSibling)&&x(b).pop():f===d.length-1&&1===c?(b=b.nextElementSibling)&&x(b).shift():d[f+c]},ma=function(){var a=w().endContainer;m(a)&&S(a)&&(A(a,0),n(a));var c=a.textContent,b=a.parentNode.classList;b.contains("atg-pilot")&&(a.nodeValue=c.replace(/[ \u00a0]/g,""),b.remove("atg-pilot"),n(a));c=Z(a.textContent);isNaN(c)||(a=A(a,c,!0).pop(),n(a));X(e.querySelectorAll("br"))},na=function(a,c){var b=
a.startContainer,d=a.startOffset;da(a);if(a.collapsed&&m(b)){var f=q(b),g=b.parentNode;if(m(b)&&(d==b.textContent.length&&(N(g)||!g.nextSibling)||r(g)))b=F(f,{addPilotNode:!0,setCaret:!0});else if(V(b,d))b=F(f,{attachAs:"previous-sibling",addPilotNode:!0,setCaret:!1});else{d=A(b,d)[1];b=F(f,{attachAs:"next-sibling"});g=d.parentNode;var e=[];do e.push(g);while(g=g.nextSibling);W(e,z(b));n(d,0)}b.className=f.className;O(b,f.getAttribute("style"));p(b)&&c&&(b.dataset.atgListId="");if(p(f))var h=U(f).dataset.atgListType;
ka(b,h)}},n=function(a,c){a&&!m(a)&&(a=x(a).pop());if(a)return c=B(c,a.length),K({startContainer:a,startOffset:c,endContainer:a,endOffset:c})},K=function(a){var c=a.startContainer,b=a.endContainer;if(c&&b){var d=B(a.startOffset,0),f=B(a.endOffset,b.length);a=document.createRange();try{a.setStart(c,d),a.setEnd(b,f)}catch(g){}a&&(window.getSelection?(c=window.getSelection(),0<c.rangeCount&&c.removeAllRanges(),c.addRange(a)):document.createRange?window.getSelection().addRange(a):document.selection&&
a.select())}return w()},E=function(a,c,b){var d;if(d=c==k.CLEAR_LIST)d=p(a)&&""===a.dataset.atgListId;d&&(c=k.DECREASE);c!==k.CLEAR_LIST&&J(a,oa(c),["margin-left:25px"]);d=parseInt(a.dataset.atgIndentPos);c==k.INCREASE?a.dataset.atgIndentPos=d?d+1:1:c==k.DECREASE?d&&(a.dataset.atgIndentPos=d-1):a.dataset.atgListId="";ka(a,b)},I=function(a,c){J(a,oa(c),["margin-left:35px"])},oa=function(a){return a==k.INCREASE?"atgIncrement":"atgDecrement"},pa=function(a,c){var b=a.startContainer,d=a.startOffset,f=
c==k.INCREASE;if(a.collapsed)if(g=q(b),V(b,d))if(p(g))E(g,c);else if(f||"0px"!==window.getComputedStyle(q(g),null).getPropertyValue("margin-left"))I(g,c);else return!1;else if(f)m(b)&&(b.nodeValue=b.textContent.splice(d,0,"\t"),n(b,d+1)),ma();else return!1;else{b=G(a,NodeFilter.SHOW_ELEMENT,u);d=0;for(var g;g=b[d];d++)p(g)?E(g,c):I(g,k.INCREASE)}return!0},V=function(a,c){var b=x(a).shift();return m(a)&&a.isSameNode(b)&&(0==c||r(a.parentNode))},qa=function(a){for(var c=ea(a),b=la(c[0],-1)||la(c[c.length-
1],1),d=0,f;f=c[d];d++)ja(f)&&(f=f.parentNode),y(f);b&&n(b);X(G(a,NodeFilter.SHOW_ELEMENT,u),function(a){return r(a)||r(z(a))});T()},A=function(a,c,b){c=B(c,0);var d=x(q(a)),f=d.indexOf(a);if(m(a))if(0==c){var g=t(d[f-1]);var e=t(a)}else c==a.length?(g=t(a),e=t(d[f+1])):(g=t(a),e=a.splitText(c),t(y(e),null,g.parentNode.getAttribute("style")),H(e.parentNode,g.parentNode));b&&ua([g,e]);return[g,e]},ea=function(a){if(a.collapsed)var c=[a.startContainer];else{c=a.startContainer;var b=a.startOffset,d=
a.endContainer;a=a.endOffset;var f=A(c,b)[1],e;c.isSameNode(d)&&(a-=b,d=f,c.length==a&&(e=f));e||(e=A(d,a)[0]);c=K({startContainer:f,startOffset:0,endContainer:e,endOffset:a});c=G(c,NodeFilter.SHOW_TEXT,L)}for(b=0;a=c[b];b++)S(a)&&(d=a.nextSibling,e=a.parentNode,a=t(a),e.insertBefore(a,d));return c};e.addEventListener("dblclick",function(a){});e.addEventListener("click",function(a){M();T()});e.addEventListener("focus",function(a){M();T()});e.addEventListener("input",function(){ma()});e.addEventListener("keydown",
function(a){var c=a.which||a.keyCode||0;8!=c&&da();var b=w();if(b)if(8==c){if(b.collapsed){var d=b.startContainer,e=b.startOffset;c=q(d);if(!pa(b,k.CLEAR_LIST))if(r(d)||r(c)||V(d,e)){if(e=c.previousElementSibling,u(e)){e=z(e);d=z(c);if(r(d))n(e.lastChild);else{r(e)&&P(e);b=[];for(d=d.firstChild;d;)b.push(d),d=d.nextSibling;0<b.length&&W(b,e)}y(c)}}else{c=d;b=q(c);d=x(b);var g=d.indexOf(c);c.nodeValue=c.textContent.splice(e-1,1,"");r(b)?ca(z(b),!0):r(c)?(y(c.parentNode),c=d[g-1],n(c)):n(c,e-1)}}else qa(b);
a.preventDefault()}else 9==c?(pa(b,a.shiftKey?k.DECREASE:k.INCREASE),a.preventDefault()):13==c?(ra||na(b,a.shiftKey),a.preventDefault()):!a.metaKey||66!=c&&73!=c&&85!=c?39==c&&r(b.endContainer)&&a.preventDefault():(fa({atgToggle:ta[c]}),a.preventDefault())});e.addEventListener("keyup",function(a){});e.addEventListener("copy",function(a){});e.addEventListener("paste",function(a){var c=w();c.collapsed||(qa(c),c=w());var b,d=c.endContainer,e=q(d);a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):
window.clipboardData&&(b=window.clipboardData.getData("Text"));var g=1E4>b.length;b=b.split("\n");1<b.length&&na(c);c=d;for(var h=0;h<b.length;h++){var k=b[h];if(0<k.length){k=t(R(k));H(k.parentNode,c.parentNode);r(c)&&y(c.parentNode);var m=1,l=k.textContent,n=l.length;do{var p=Z(l.slice(0,m));isNaN(p)?m+=1:(k=A(k,p,!0).pop(),l=k.textContent,n=l.length,m=1)}while(m<=n&&g)}null!==b[h+1]&&(e=F(e,{addPilotNode:!0}),c=x(e).shift())}K({startContainer:d,endContainer:c});a.preventDefault()});document.addEventListener("selectionchange",
function(a){va(G(w(),NodeFilter.SHOW_TEXT,ja))});return{attachMenubar:function(a){a&&(C=a,C.addEventListener("click",function(a){M();a=a.target;var b;a:for(b=a;b&&!D(b,"atg-submenu")&&!D(b,"atg-menu");)if((b=b.parentNode)&&b.isSameNode(e)){b=void 0;break a}if(b){var c=b.querySelector(".atg-submenu");if(c){var f=window.getComputedStyle(c);c.style.display="none"===f.display?"":"none"}else if(b.dataset.atgSubmenu){if(b.dataset.atgSubmenu.match(/Palette$/)){if(f=b.getElementsByClassName("atg-submenu")[0])f.style.display=
"";else{f=v("div","atg-submenu atg-palette");a=b.dataset.atgSubmenu.split("Palette")[0];f.dataset.atgPalette=a;f.dataset.atgScope=b.dataset.atgScope;b.appendChild(f);var g=Math.round(36),h=Math.round(2);c=Math.round(18);for(var k=0,m=100,l=94;5>k;k++,m-=h,l-=c){b=f.appendChild(v("div","atg-palette-row"));for(var n=0,p=0;10>n;n++,p+=g)Q(b,p,m,l,a)}b=f.appendChild(v("div","atg-palette-row"));c=Math.round(100/9);g=0;for(l=c;9>g;g++,l+=c)Q(b,0,0,l,a);b=Q(b,0,0,100);b.classList.add("atg-crossed-cell");
"color"===a&&(b.dataset.atgPaletteColor="#000")}_activeSubmenu=f}}else b.dataset.atgPalette&&(c=b.dataset.atgPalette,l=a.dataset,l.atgSet||(g=l.atgPaletteColor,"color"===c?f="color: "+g:"highlight"===c&&(f="background-color: "+g),l.atgSet=f)),fa(a.dataset,b.dataset.atgScope),M()}}))}}}}();
