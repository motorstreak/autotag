/*
 autotagjs.js v1.5 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function B(e,f){return"undefined"===typeof e||null==e?f:e}function G(e,f){return f.parentNode.insertBefore(e,f.nextSibling)}function O(e,f){e&&e.nodeType==Node.ELEMENT_NODE&&f&&f.length&&e.setAttribute("style",f)}function X(e,f){for(var C=0,k;k=e[C];C++)f.appendChild(k)}function D(e,f){return e&&e.classList&&e.classList.contains(f)}function v(e,f){var k=document.createElement(e);f&&(k.className=f);return k}function x(e){return e&&e.parentNode.removeChild(e)}function Y(e,f){for(var k=
0,m;m=e[k];k++)f&&!f(m)||x(m)}function P(e){for(;e&&e.hasChildNodes();)e.removeChild(e.lastChild)}function m(e){return e&&e.nodeType==Node.TEXT_NODE}function w(){var e;if("undefined"!=typeof window.getSelection){var f=window.getSelection();f.rangeCount&&(e=f.getRangeAt(0))}else(f=document.selection)&&"Control"!=f.type&&(e=f.createRange());return e}function Z(e){var f,k="",m={M:1E3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};for(f in m)for(;e>=m[f];)k+=f,e-=m[f];return k}String.prototype.splice||
(String.prototype.splice=function(e,f,k){return this.slice(0,e)+k+this.slice(e+Math.abs(f))});var k=Object.freeze({CLEAR_LIST:0,INCREASE:1,DECREASE:2}),ra={"numbered-period":{styles:["decimal","lower-alpha","lower-roman"],suffix:"."},"numbered-bracket":{styles:["decimal","lower-alpha","lower-roman"],suffix:")"},"numbered-collated":{styles:["decimal"],suffix:". ",seperator:"."},bulletted:{styles:"disc circle square white-square diamond white-diamond".split(" ")}},sa=Object.freeze({66:"font-weight:bold",
73:"font-style:italic",85:"text-decoration:underline"});return function(e,f){var C;f=f||{};var qa=f.ignoreReturnKey||!1,ta=f.decorator||function(a,d){},aa=f.splitter||function(a){if(a.match(/(\b[ \u00a0!\?\.])|([ \u00a0!\?\.]+\b)/))return a.length-1},ua=f.afterSelection||function(a){},va=f.onMenuClick||function(){},ba=function(a,d){if(Array.isArray(a))for(var b=0,c;c=a[b];b++)ba(c,d);else for(b=0;c=d[b];b++)switch(c=c.split(/ +/),c[0]){case "indent":c=a;var h=k.INCREASE;r(c)?E(c,h):H(c,h);break;case "outdent":c=
a;h=k.DECREASE;r(c)?E(c,h):H(c,h);break;case "list":E(a,k.INCREASE,c[1])}},I=function(a,d,b){if(Array.isArray(a))for(var c=0,h;h=a[c];c++)I(h,d,b);else for(a=m(a)?a.parentNode:a,c=0;c<b.length;c++){var g=b[c].split(/\s*:\s*/);h=g[0];var e=g[1];g=a.style;var f=g.getPropertyValue(h);if(0<f.length&&d.match(/^atg(Unset|Toggle)/))g.removeProperty(h);else if(d.match(/^atg(Set|Initialize|Toggle)/))g.setProperty(h,e);else if(d.match(/^atg(Increment|Decrement)/)){f=f||getComputedStyle(a).getPropertyValue(h);
e=ca(e);f=ca(f);switch(d){case "atgIncrement":f+=e;break;case "atgDecrement":f-=e}0>=f?g.removeProperty(h):g.setProperty(h,f+"px")}}},Q=function(a,d,b,c,h){b="hsla("+d+", "+b+"%, "+c+"%, 1.0)";d=v("div","atg-palette-cell");d.style.background=b;d.dataset.atgPaletteColor=b;if("highlight"===h){h=d.dataset;b=d.style.background.match(/[.?\d]+/g);for(c=0;3>c;c++)b[c]/=255,b[c]=.03928>=b[c]?b[c]/12.92:Math.pow((b[c]+.055)/1.055,2.4);h.atgPaletteContrastColor=.179<.2126*b[0]+.7152*b[1]+.0722*b[2]?"#000":
"#FFF"}return a.appendChild(d)},J=function(a,d){d=d||{};var b=v("div","atg-line"),c=v("div","atg-line-body");b.appendChild(c);b.dataset.atgIndentPos=0;if(a){switch(d.attachAs){case "child":a.appendChild(b);break;case "next-sibling":G(b,a);break;case "previous-sibling":a.parentNode.insertBefore(b,a);break;default:G(b,a)}"child"!==d.attachAs&&r(a)&&(b.dataset.atgIndentPos=a.dataset.atgIndentPos);d.addPilotNode&&da(c,d.setCaret)}return b},da=function(a,d){P(a);var b=t(R("\u00a0")),c=b.parentNode;a.appendChild(c);
O(c,"");c.classList.add("atg-pilot");d&&p(b,0)},t=function(a,d,b){if(m(a)){if(!a.parentNode||S(a))d=v("span",d),O(d,b||""),a.parentNode&&a.parentNode.insertBefore(d,a),d.appendChild(a);return a}},R=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},ea=function(a){a=B(a,w());a.collapsed&&p(a.endContainer,a.endOffset)},T=function(){if(0==e.children.length)return J(e,{attachAs:"child",addPilotNode:!0,setCaret:!0})},fa=function(a,d){if(a){var b=w();switch(d){case "line":b=
F(b,NodeFilter.SHOW_ELEMENT,u);break;default:b=U(b)}b=b||[];b=b.filter(Boolean);for(var c in a)if(a.hasOwnProperty(c)){var h=b,g=c,e=a[c].split(/\s*;\s*/);"atgCommand"==g?ba(h,e):"atgCallback"==g?va(e,h):I(h,g,e)}K({startContainer:b.shift(),endContainer:b.pop()})}},z=function(a){a&&!u(a)&&(a=q(a));return a&&a.querySelector(".atg-line-body")},V=function(a){a&&!u(a)&&(a=q(a));return a&&a.querySelector(".atg-line-leader")},q=function(a){if(a&&a.isSameNode(e))return e&&e.querySelector("div:first-child");
for(;a&&!u(a);)a=a.parentNode;return a},y=function(a){a=u(a)?a:q(a);return ha(ia(z(a),NodeFilter.SHOW_TEXT),m)},ha=function(a,d,b){var c=[];if(a){do{var h=a.currentNode;d&&!d(h)||c.push(h)}while(a.nextNode()&&(!b||c.length<=b))}return c},F=function(a,d,b){return ha(wa(a,d,b),b)},ca=function(a){return parseInt(a&&a.match(/^[-+]?\d*\.?\d+/)[0]||0)},wa=function(a,d,b){if(a){b=b||L;for(var c=a.commonAncestorContainer;!(!c||b(c)||c&&c.isSameNode(e)||c&&c.nodeType==Node.DOCUMENT_NODE);)c=c.parentNode;return ia(c,
d,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(xa){c.selectNodeContents(b)}b=-1==a.compareBoundaryPoints(Range.END_TO_START,c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})}},ia=function(a,d,b){return document.createTreeWalker(a,d,{acceptNode:function(a){return!b||b(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1)},M=function(){for(var a=menubar.querySelectorAll(".atg-submenu"),d=0,b;b=a[d];d++)b.style.display=
"none"},u=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&D(a,"atg-line")},N=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&D(a,"atg-line-body")},L=function(a){return a&&m(a)&&(N(a.parentNode)||N(a.parentNode.parentNode))},ja=function(a){return L(a)&&!N(a.parentNode)},S=function(a){return L(a)&&D(a.parentNode,"atg-line-body")},n=function(a){a=a&&a.textContent;return 0==a.length||1==a.length&&"\u00a0"==a},r=function(a){return u(a)&&"0"!==a.dataset.atgIndentPos},ka=function(a,d){for(var b=
a,c=a;r(c.previousSibling);)c=c.previousSibling;a=c;if(r(a)){c=[];var h=0;do{var g=a.dataset.atgListId;if(isNaN(g)||0<g.length){g=parseInt(a.dataset.atgIndentPos);g>h&&(c[g-1]=0);c[g-1]+=1;h=g;for(g=0;g<c.length;g++)c[g]||(c[g]=1);a.dataset.atgListId=c.slice(0,parseInt(h)).join(".")}var e=a,f=d;g=V(e);g||(g=v("div","atg-line-leader"),g.setAttribute("contenteditable","false"),e.insertBefore(g,e.firstChild));f=f||g.dataset.atgListType;g.dataset.atgListType=f;var k=e.dataset.atgListId;if(null!==k){P(g);
var l;f=ra[f];if(0==k.length)f="";else{e=f.suffix||"";var m=f.seperator||"",n=[];k=k.split(".");for(var p=f.styles.length,q=m?0:k.length-1;l=parseInt(k[q]);q++){switch(f.styles[(p+q)%p]){case "lower-alpha":l=String.fromCharCode(97+(26+l-1)%26);break;case "upper-alpha":l=String.fromCharCode(65+(26+l-1)%26);break;case "lower-roman":l=Z(l).toLowerCase();break;case "upper-roman":l=Z(l);break;case "disc":l="\u25cf";break;case "circle":l="\u25cb";break;case "square":l="\u25a0";break;case "white-square":l=
"\u25a1";break;case "diamond":l="\u25c6";break;case "white-diamond":l="\u25c7"}n.push(l)}f=n.join(m)+e}g.appendChild(R(f))}}while(r(a.nextSibling)&&(a=a.nextSibling))}b&&!r(b)&&(b=V(b))&&x(b)},la=function(a,d){d%=2;var b=q(a),c=y(b),h=c.indexOf(a);return 0===h&&-1===d?b.previousSibling&&y(b.previousSibling).pop():h===c.length-1&&1===d?b.nextSibling&&y(b.nextSibling).shift():c[h+d]},ma=function(){var a=w().endContainer;m(a)&&S(a)&&(A(a,0),p(a));var d=a.textContent,b=a.parentNode.classList;b.contains("atg-pilot")&&
(a.nodeValue=d.replace(/[ \u00a0]/g,""),b.remove("atg-pilot"),p(a));if(d=aa(a.textContent))a=A(a,d,!0).pop(),p(a);Y(e.querySelectorAll("br"))},p=function(a,d){a&&!m(a)&&(a=y(a).pop());if(a)return d=B(d,a.length),K({startContainer:a,startOffset:d,endContainer:a,endOffset:d})},K=function(a){var d=a.startContainer,b=a.endContainer;if(d&&b){var c=B(a.startOffset,0),h=B(a.endOffset,b.length);a=document.createRange();try{a.setStart(d,c),a.setEnd(b,h)}catch(g){}a&&(window.getSelection?(d=window.getSelection(),
0<d.rangeCount&&d.removeAllRanges(),d.addRange(a)):document.createRange?window.getSelection().addRange(a):document.selection&&a.select())}return w()},E=function(a,d,b){var c;if(c=d==k.CLEAR_LIST)c=r(a)&&""===a.dataset.atgListId;c&&(d=k.DECREASE);d!==k.CLEAR_LIST&&I(a,na(d),["margin-left:25px"]);c=parseInt(a.dataset.atgIndentPos);d==k.INCREASE?a.dataset.atgIndentPos=c?c+1:1:d==k.DECREASE?c&&(a.dataset.atgIndentPos=c-1):a.dataset.atgListId="";ka(a,b)},H=function(a,d){I(a,na(d),["margin-left:35px"])},
na=function(a){return a==k.INCREASE?"atgIncrement":"atgDecrement"},oa=function(a,d){var b=a.startContainer,c=a.startOffset,h=d==k.INCREASE;if(a.collapsed)if(g=q(b),W(b,c))if(r(g))E(g,d);else if(h||"0px"!==window.getComputedStyle(q(g),null).getPropertyValue("margin-left"))H(g,d);else return!1;else if(h)m(b)&&(b.nodeValue=b.textContent.splice(c,0,"\t"),p(b,c+1)),ma();else return!1;else{b=F(a,NodeFilter.SHOW_ELEMENT,u);c=0;for(var g;g=b[c];c++)r(g)?E(g,d):H(g,k.INCREASE)}return!0},W=function(a,d){var b=
y(a).shift();return m(a)&&a.isSameNode(b)&&(0==d||n(a.parentNode))},pa=function(a){for(var d=U(a),b=la(d[0],-1)||la(d[d.length-1],1),c=0,h;h=d[c];c++)ja(h)&&(h=h.parentNode),x(h);b&&p(b);Y(F(a,NodeFilter.SHOW_ELEMENT,u),function(a){return n(a)||n(z(a))});T()},A=function(a,d,b){d=B(d,0);var c=y(q(a)),h=c.indexOf(a);if(m(a))if(0==d){var g=t(c[h-1]);var e=t(a)}else d==a.length?(g=t(a),e=t(c[h+1])):(g=t(a),e=a.splitText(d),t(x(e),null,g.parentNode.getAttribute("style")),G(e.parentNode,g.parentNode));
b&&ta(g.parentNode,g.textContent);return[g,e]},U=function(a){if(a.collapsed)var d=[a.startContainer];else{d=a.startContainer;var b=a.startOffset,c=a.endContainer;a=a.endOffset;var h=A(d,b)[1],e;d.isSameNode(c)&&(a-=b,c=h,d.length==a&&(e=h));e||(e=A(c,a)[0]);d=K({startContainer:h,startOffset:0,endContainer:e,endOffset:a});d=F(d,NodeFilter.SHOW_TEXT,L)}for(b=0;a=d[b];b++)S(a)&&(c=a.nextSibling,e=a.parentNode,a=t(a),e.insertBefore(a,c));return d};e.addEventListener("dblclick",function(a){});e.addEventListener("click",
function(a){M();T()});e.addEventListener("focus",function(a){M();T()});e.addEventListener("input",function(){ma()});e.addEventListener("keydown",function(a){var d=a.which||a.keyCode||0;8!=d&&ea();var b=w();if(b)if(8==d){if(b.collapsed){var c=b.startContainer;d=b.startOffset;var e=q(c);if(!oa(b,k.CLEAR_LIST))if(n(c)||n(e)||W(c,d)){if(d=e.previousSibling,u(d)){d=z(d);c=z(e);if(n(c))p(d.lastChild);else{n(d)&&P(d);b=[];for(c=c.firstChild;c;)b.push(c),c=c.nextSibling;0<b.length&&X(b,d)}x(e)}}else{e=c;
b=q(e);c=y(b);var g=c.indexOf(e);e.nodeValue=e.textContent.splice(d-1,1,"");n(b)?da(z(b),!0):n(e)?(x(e.parentNode),e=c[g-1],p(e)):p(e,d-1)}}else pa(b);a.preventDefault()}else if(9==d)oa(b,a.shiftKey?k.DECREASE:k.INCREASE),a.preventDefault();else if(13==d){if(!qa&&(d=a.shiftKey,c=b.startContainer,g=b.startOffset,ea(b),b.collapsed&&m(c))){b=q(c);var f=c.parentNode;if(m(c)&&(g==c.textContent.length&&(N(f)||!f.nextSibling)||n(f)))c=J(b,{addPilotNode:!0,setCaret:!0});else if(W(c,g))c=J(b,{attachAs:"previous-sibling",
addPilotNode:!0,setCaret:!1});else{g=A(c,g)[1];c=J(b,{attachAs:"next-sibling"});f=g.parentNode;var t=[];do t.push(f);while(f=f.nextSibling);X(t,z(c));p(g,0)}c.className=b.className;O(c,b.getAttribute("style"));r(c)&&d&&(c.dataset.atgListId="");r(b)&&(e=V(b).dataset.atgListType);ka(c,e)}a.preventDefault()}else!a.metaKey||66!=d&&73!=d&&85!=d?39==d&&n(b.endContainer)&&a.preventDefault():(fa({atgToggle:sa[d]}),a.preventDefault())});e.addEventListener("keyup",function(a){});e.addEventListener("copy",function(a){});
e.addEventListener("paste",function(a){var d=w();d.collapsed||(pa(d),d=w());var b;d=U(d);a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));b=t(R(b));d=d.pop().parentNode;G(b.parentNode,d);n(d)&&x(d);d=1;var c=b.textContent,e=c.length,g=b;do{var f=aa(c.slice(0,d));f?(b=A(b,f,!0).pop(),c=b.textContent,e=c.length,d=1):d+=1}while(d<=e);K({startContainer:g,endContainer:b});a.preventDefault()});document.addEventListener("selectionchange",
function(a){ua(F(w(),NodeFilter.SHOW_TEXT,ja))});return{attachMenubar:function(a){a&&(C=a,C.addEventListener("click",function(a){M();a=a.target;var b;a:for(b=a;b&&!D(b,"atg-submenu")&&!D(b,"atg-menu");)if((b=b.parentNode)&&b.isSameNode(e)){b=void 0;break a}if(b){var c=b.querySelector(".atg-submenu");if(c){var d=window.getComputedStyle(c);c.style.display="none"===d.display?"":"none"}else if(b.dataset.atgSubmenu){if(b.dataset.atgSubmenu.match(/Palette$/)){if(d=b.getElementsByClassName("atg-submenu")[0])d.style.display=
"";else{d=v("div","atg-submenu atg-palette");a=b.dataset.atgSubmenu.split("Palette")[0];d.dataset.atgPalette=a;d.dataset.atgScope=b.dataset.atgScope;b.appendChild(d);var f=Math.round(36),k=Math.round(2);c=Math.round(18);for(var m=0,n=100,l=94;5>m;m++,n-=k,l-=c){b=d.appendChild(v("div","atg-palette-row"));for(var p=0,q=0;10>p;p++,q+=f)Q(b,q,n,l,a)}b=d.appendChild(v("div","atg-palette-row"));c=Math.round(100/9);f=0;for(l=c;9>f;f++,l+=c)Q(b,0,0,l,a);b=Q(b,0,0,100);b.classList.add("atg-crossed-cell");
"color"===a&&(b.dataset.atgPaletteColor="#000")}_activeSubmenu=d}}else b.dataset.atgPalette&&(c=b.dataset.atgPalette,l=a.dataset,l.atgSet||(f=l.atgPaletteColor,"color"===c?d="color: "+f:"highlight"===c&&(d="background-color: "+f),l.atgSet=d)),fa(a.dataset,b.dataset.atgScope),M()}}))}}}}();
