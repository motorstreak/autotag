/*
 autotagjs.js v1.5 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function A(e,f){return"undefined"===typeof e||null==e?f:e}function K(e,f){e&&e.nodeType==Node.ELEMENT_NODE&&e.setAttribute("style",f)}function W(e,f){for(var h=0,l;l=e[h];h++)f.appendChild(l)}function v(e,f){return e&&e.classList&&e.classList.contains(f)}function w(e,f){var h=document.createElement(e);f&&(h.className=f);return h}function y(e){return e&&e.parentNode.removeChild(e)}function Y(e,f){for(var h=0,l;l=e[h];h++)f&&!f(l)||y(l)}function L(e){for(;e&&e.hasChildNodes();)e.removeChild(e.lastChild)}
function l(e){return e&&e.nodeType==Node.TEXT_NODE}function M(){var e;if("undefined"!=typeof window.getSelection){var f=window.getSelection();f.rangeCount&&(e=f.getRangeAt(0))}else(f=document.selection)&&"Control"!=f.type&&(e=f.createRange());return e}function N(e){if(e)if(window.getSelection){var f=window.getSelection();0<f.rangeCount&&f.removeAllRanges();f.addRange(e)}else document.createRange?window.getSelection().addRange(e):document.selection&&e.select()}function Z(e){var f,h="",l={M:1E3,CM:900,
D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};for(f in l)for(;e>=l[f];)h+=f,e-=l[f];return h}String.prototype.splice||(String.prototype.splice=function(e,f,h){return this.slice(0,e)+h+this.slice(e+Math.abs(f))});var n=Object.freeze({CLEAR_LIST:0,INCREASE:1,DECREASE:2}),pa={"numbered-period":{styles:["decimal","lower-alpha","lower-roman"],suffix:"."},"numbered-bracket":{styles:["decimal","lower-alpha","lower-roman"],suffix:")"},"numbered-collated":{styles:["decimal"],suffix:". ",seperator:"."},
bulletted:{styles:"disc circle square white-square diamond white-diamond".split(" ")}},qa=Object.freeze({66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"});return function(e,f){var h,X,O="";f=f||{};var ra=f.ignoreReturnKey||!1,sa=f.decorator||function(a,d){},ta=f.splitter||function(a){a=a.textContent;if(a.match(/(.+[ !?\.])|([ !?\.].)/))return a.length-1},ua=f.afterSelection||function(a){},va=f.onMenuClick||function(){},aa=function(a,d){if(Array.isArray(a))for(var b=0,c;c=
a[b];b++)aa(c,d);else for(b=0;c=d[b];b++)switch(c=c.split(/ +/),c[0]){case "indent":c=a;var k=n.INCREASE;r(c)?B(c,k):E(c,k);break;case "outdent":c=a;k=n.DECREASE;r(c)?B(c,k):E(c,k);break;case "list":B(a,n.INCREASE,c[1])}},F=function(a,d,b){if(Array.isArray(a))for(var c=0,k;k=a[c];c++)F(k,d,b);else for(a=l(a)?a.parentNode:a,c=0;c<b.length;c++){var g=b[c].split(/\s*:\s*/);k=g[0];var e=g[1];g=a.style;var f=g.getPropertyValue(k);if(0<f.length&&d.match(/^atg(Unset|Toggle)/))g.removeProperty(k);else if(d.match(/^atg(Set|Initialize|Toggle)/))g.setProperty(k,
e);else if(d.match(/^atg(Increment|Decrement)/)){f=f||getComputedStyle(a).getPropertyValue(k);e=ba(e);f=ba(f);switch(d){case "atgIncrement":f+=e;break;case "atgDecrement":f-=e}0>=f?g.removeProperty(k):g.setProperty(k,f+"px")}}},P=function(a,d,b,c,k){b="hsla("+d+", "+b+"%, "+c+"%, 1.0)";d=w("div","atg-palette-cell");d.style.background=b;d.dataset.atgPaletteColor=b;if("highlight"===k){k=d.dataset;b=d.style.background.match(/[.?\d]+/g);for(c=0;3>c;c++)b[c]/=255,b[c]=.03928>=b[c]?b[c]/12.92:Math.pow((b[c]+
.055)/1.055,2.4);k.atgPaletteContrastColor=.179<.2126*b[0]+.7152*b[1]+.0722*b[2]?"#000":"#FFF"}return a.appendChild(d)},G=function(a,d){d=d||{};var b=w("div","atg-line"),c=w("div","atg-line-body");b.appendChild(c);b.dataset.atgIndentPos=0;if(a){switch(d.attachAs){case "child":a.appendChild(b);break;case "next-sibling":a.parentNode.insertBefore(b,a.nextSibling);break;case "previous-sibling":a.parentNode.insertBefore(b,a);break;default:a.parentNode.insertBefore(b,a.nextSibling)}"child"!==d.attachAs&&
r(a)&&(b.dataset.atgIndentPos=a.dataset.atgIndentPos);d.addPilotNode&&ca(c,d.setCaret)}return b},ca=function(a,d){L(a);var b=x(da("\u00a0")),c=b.parentNode;a.appendChild(c);K(c,O);c.classList.add("atg-pilot");d&&p(b,0)},x=function(a,d,b){if(l(a)){if(!a.parentNode||Q(a))d=w("span",d),K(d,b||O),d.classList.add("atg-text"),a.parentNode&&a.parentNode.insertBefore(d,a),d.appendChild(a);return a}},da=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},ea=function(a){a=A(a,M());
a.collapsed&&p(a.endContainer,a.endOffset)},R=function(){if(0==e.children.length)return G(e,{attachAs:"child",addPilotNode:!0,setCaret:!0})},ha=function(a,d){if(h&&a){switch(d){case "line":var b=C(h,NodeFilter.SHOW_ELEMENT,t);break;default:b=fa(h)}b=b||[];b=b.filter(Boolean);for(var c in a)if(a.hasOwnProperty(c)){var k=b,g=c,e=a[c].split(/\s*;\s*/);"atgCommand"==g?aa(k,e):"atgCallback"==g?va(e,k):F(k,g,e)}N(h)}},z=function(a){t(a)||(a=u(a));return a.querySelector(".atg-line-body")},S=function(a){t(a)||
(a=u(a));return a.querySelector(".atg-line-leader")},u=function(a){if(a&&a.isSameNode(e))return e.querySelector("div:first-child");for(;a&&!t(a);)a=a.parentNode;return a},H=function(a){a=t(a)?a:u(a);return ia(ja(z(a),NodeFilter.SHOW_TEXT),l)},ia=function(a,d,b){var c=[];do{var k=a.currentNode;d&&!d(k)||c.push(k)}while(a.nextNode()&&(!b||c.length<=b));return c},C=function(a,d,b){return ia(wa(a,d,b),b)},ba=function(a){return parseInt(a&&a.match(/^[-+]?\d*\.?\d+/)[0]||0)},wa=function(a,d,b){b=b||I;for(var c=
a.commonAncestorContainer;!(!c||b(c)||c&&c.isSameNode(e)||c&&c.nodeType==Node.DOCUMENT_NODE);)c=c.parentNode;return ja(c,d,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(ya){c.selectNodeContents(b)}b=-1==a.compareBoundaryPoints(Range.END_TO_START,c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})},ja=function(a,d,b){return document.createTreeWalker(a,d,{acceptNode:function(a){return!b||b(a)?NodeFilter.FILTER_ACCEPT:
NodeFilter.FILTER_REJECT}},!1)},J=function(){for(var a=menubar.querySelectorAll(".atg-submenu"),d=0,b;b=a[d];d++)b.style.display="none"},t=function(a){return a&&a.nodeType==Node.ELEMENT_NODE&&v(a,"atg-line")},I=function(a){return a&&l(a)&&(v(a.parentNode,"atg-line-body")||v(a.parentNode,"atg-text"))},T=function(a){return I(a)&&v(a.parentNode,"atg-text")},Q=function(a){return I(a)&&v(a.parentNode,"atg-line-body")},q=function(a){a=a&&a.textContent;return 0==a.length||1==a.length&&"\u00a0"==a},r=function(a){return t(a)&&
"0"!==a.dataset.atgIndentPos},ka=function(a,d){for(var b=a,c=a;r(c.previousSibling);)c=c.previousSibling;a=c;if(r(a)){c=[];var k=0;do{var g=a.dataset.atgListId;if(isNaN(g)||0<g.length){g=parseInt(a.dataset.atgIndentPos);g>k&&(c[g-1]=0);c[g-1]+=1;k=g;for(g=0;g<c.length;g++)c[g]||(c[g]=1);a.dataset.atgListId=c.slice(0,parseInt(k)).join(".")}var e=a,f=d;g=S(e);g||(g=w("div","atg-line-leader"),g.setAttribute("contenteditable","false"),e.insertBefore(g,e.firstChild));f=f||g.dataset.atgListType;g.dataset.atgListType=
f;var h=e.dataset.atgListId;if(null!==h){L(g);var m;f=pa[f];if(0==h.length)f="";else{e=f.suffix||"";var l=f.seperator||"",n=[];h=h.split(".");for(var p=f.styles.length,q=l?0:h.length-1;m=parseInt(h[q]);q++){switch(f.styles[(p+q)%p]){case "lower-alpha":m=String.fromCharCode(97+(26+m-1)%26);break;case "upper-alpha":m=String.fromCharCode(65+(26+m-1)%26);break;case "lower-roman":m=Z(m).toLowerCase();break;case "upper-roman":m=Z(m);break;case "disc":m="\u25cf";break;case "circle":m="\u25cb";break;case "square":m=
"\u25a0";break;case "white-square":m="\u25a1";break;case "diamond":m="\u25c6";break;case "white-diamond":m="\u25c7"}n.push(m)}f=n.join(l)+e}g.appendChild(da(f))}}while(r(a.nextSibling)&&(a=a.nextSibling))}r(b)||(b=S(b))&&y(b)},U=function(){var a=h.endContainer;l(a)&&Q(a)&&(D(a,0),p(a));var d=a.textContent;d.match(RegExp("\u00a0"))&&(a.nodeValue=a.textContent.replace(RegExp("\u00a0","g"),""),p(a),a.parentNode.classList.remove("atg-pilot"));var b=ta(a);b&&0<b&&b<d.length&&(a=D(a,b)[1],p(a));Y(e.querySelectorAll("br"))},
la=function(){var a=M();if(a&&a!=h){var d=a.endContainer;l(a.startContainer)&&l(d)&&(h=a,T(d)&&(O=d.parentNode.getAttribute("style")),a.collapsed&&(sa(d.parentNode,d.textContent),1==a.endOffset&&q(d)&&p(d,0)));return h}},p=function(a,d){l(a)||(a=H(a).pop());if(a)return d=A(d,a.length),ma({startContainer:a,startOffset:d,endContainer:a,endOffset:d})},ma=function(a){var d=a.startContainer,b=a.endContainer;if(d&&b){var c=A(a.startOffset,0);a=A(a.endOffset,b.length);var k=document.createRange();try{k.setStart(d,
c),k.setEnd(b,a),h=k}catch(g){}N(k)}return k},B=function(a,d,b){var c;if(c=d==n.CLEAR_LIST)c=r(a)&&""===a.dataset.atgListId;c&&(d=n.DECREASE);d!==n.CLEAR_LIST&&F(a,na(d),["margin-left:25px"]);c=parseInt(a.dataset.atgIndentPos);d==n.INCREASE?a.dataset.atgIndentPos=c?c+1:1:d==n.DECREASE?c&&(a.dataset.atgIndentPos=c-1):a.dataset.atgListId="";ka(a,b)},E=function(a,d){F(a,na(d),["margin-left:35px"])},na=function(a){return a==n.INCREASE?"atgIncrement":"atgDecrement"},oa=function(a,d){var b=a.startContainer,
c=a.startOffset,k=d==n.INCREASE;if(a.collapsed)if(e=u(b),V(b,c))if(r(e))B(e,d);else if(k||"0px"!==window.getComputedStyle(u(e),null).getPropertyValue("margin-left"))E(e,d);else return!1;else if(k)l(b)&&(b.nodeValue=b.textContent.splice(c,0,"\t"),p(b,c+1)),U();else return!1;else{b=C(a,NodeFilter.SHOW_ELEMENT,t);c=0;for(var e;e=b[c];c++)r(e)?B(e,d):E(e,n.INCREASE)}return!0},V=function(a,d){var b=H(a).shift();return l(a)&&a.isSameNode(b)&&(0==d||q(a.parentNode))},xa=function(a){for(var d=fa(a),b=0,c;c=
d[b];b++)T(c)&&(c=c.parentNode),y(c);Y(C(a,NodeFilter.SHOW_ELEMENT,t),function(a){return q(a)||q(z(a))});R()},D=function(a,d){d=A(d,0);var b=H(u(a)),c=b.indexOf(a);if(l(a))if(0==d){var e=x(b[c-1]);var g=x(a)}else d==a.length?(e=x(a),g=x(b[c+1])):(e=x(a),g=a.splitText(d),x(y(g),null,e.parentNode.getAttribute("style")),b=e.parentNode,b.parentNode.insertBefore(g.parentNode,b.nextSibling));return[e,g]},fa=function(a){if(a.collapsed)var d=[a.startContainer];else{d=a.startContainer;var b=a.startOffset,
c=a.endContainer;a=a.endOffset;var e=D(d,b)[1],g;d.isSameNode(c)&&(a-=b,c=e,d.length==a&&(g=e));g||(g=D(c,a)[0]);h=ma({startContainer:e,startOffset:0,endContainer:g,endOffset:a});d=C(h,NodeFilter.SHOW_TEXT,I)}for(b=0;a=d[b];b++)Q(a)&&(c=a.nextSibling,g=a.parentNode,a=x(a),g.insertBefore(a,c));return d};e.addEventListener("dblclick",function(a){la()});e.addEventListener("click",function(a){J();R()});e.addEventListener("focus",function(a){J();R()});e.addEventListener("input",function(){U()});e.addEventListener("keydown",
function(a){var d=a.which||a.keyCode||0;8!=d&&ea();var b=M();if(8==d){if(b.collapsed){var c=b.startContainer;d=b.startOffset;var e=u(c);if(!oa(b,n.CLEAR_LIST))if(q(c)||q(e)||V(c,d)){if(d=e.previousSibling,t(d)){d=z(d);c=z(e);if(q(c))p(d.lastChild);else{q(d)&&L(d);b=[];for(c=c.firstChild;c;)b.push(c),c=c.nextSibling;0<b.length&&W(b,d)}y(e)}}else{e=c;b=u(e);c=H(b);var g=c.indexOf(e);e.nodeValue=e.textContent.splice(d-1,1,"");q(b)?ca(z(b),!0):q(e)?(y(e.parentNode),e=c[g-1],p(e)):p(e,d-1)}}else xa(b);
a.preventDefault()}else if(9==d)oa(b,a.shiftKey?n.DECREASE:n.INCREASE),a.preventDefault();else if(13==d){if(!ra&&(d=a.shiftKey,c=b.startContainer,g=b.startOffset,ea(b),b.collapsed&&l(c))){b=u(c);var f=c.parentNode,h;if(h=l(c)){if(h=g==c.textContent.length)h=f&&f.nodeType==Node.ELEMENT_NODE&&v(f,"atg-line-body")||!f.nextSibling;h=h||q(f)}if(h)c=G(b,{addPilotNode:!0,setCaret:!0});else if(V(c,g))c=G(b,{attachAs:"previous-sibling",addPilotNode:!0,setCaret:!1});else{g=D(c,g)[1];c=G(b,{attachAs:"next-sibling"});
f=g.parentNode;h=[];do h.push(f);while(f=f.nextSibling);W(h,z(c));p(g,0)}c.className=b.className;K(c,b.getAttribute("style"));r(c)&&d&&(c.dataset.atgListId="");r(b)&&(e=S(b).dataset.atgListType);ka(c,e)}a.preventDefault()}else!a.metaKey||66!=d&&73!=d&&85!=d?39==d&&q(b.endContainer)&&a.preventDefault():(ha({atgToggle:qa[d]}),a.preventDefault())});e.addEventListener("keyup",function(a){});e.addEventListener("copy",function(a){});e.addEventListener("paste",function(a){var d,b=h.endContainer;a.clipboardData?
d=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(d=window.clipboardData.getData("Text"));l(b)?(b.nodeValue+=d,p(b)):(d=document.createTextNode(d),b.insertBefore(d,b.firstChild),p(d));U();a.preventDefault()});document.addEventListener("selectionchange",function(a){la()&&ua(C(h,NodeFilter.SHOW_TEXT,T))});return{attachMenubar:function(a){a&&(X=a,X.addEventListener("click",function(a){J();N(h);a=a.target;var b;a:for(b=a;b&&!v(b,"atg-submenu")&&!v(b,"atg-menu");)if((b=
b.parentNode)&&b.isSameNode(e)){b=void 0;break a}if(b){var c=b.querySelector(".atg-submenu");if(c){var d=window.getComputedStyle(c);c.style.display="none"===d.display?"":"none"}else if(b.dataset.atgSubmenu){if(b.dataset.atgSubmenu.match(/Palette$/)){if(d=b.getElementsByClassName("atg-submenu")[0])d.style.display="";else{d=w("div","atg-submenu atg-palette");a=b.dataset.atgSubmenu.split("Palette")[0];d.dataset.atgPalette=a;d.dataset.atgScope=b.dataset.atgScope;b.appendChild(d);var f=Math.round(36),
l=Math.round(2);c=Math.round(18);for(var n=0,p=100,m=94;5>n;n++,p-=l,m-=c){b=d.appendChild(w("div","atg-palette-row"));for(var q=0,r=0;10>q;q++,r+=f)P(b,r,p,m,a)}b=d.appendChild(w("div","atg-palette-row"));c=Math.round(100/9);f=0;for(m=c;9>f;f++,m+=c)P(b,0,0,m,a);b=P(b,0,0,100);b.classList.add("atg-crossed-cell");"color"===a&&(b.dataset.atgPaletteColor="#000")}_activeSubmenu=d}}else b.dataset.atgPalette&&(c=b.dataset.atgPalette,m=a.dataset,m.atgSet||(f=m.atgPaletteColor,"color"===c?d="color: "+f:
"highlight"===c&&(d="background-color: "+f),m.atgSet=d)),ha(a.dataset,b.dataset.atgScope),J()}}))}}}}();
