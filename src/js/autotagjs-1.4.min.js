/*
 autotagjs.js v1.4 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function p(f,h){return"undefined"===typeof f||null==f?h:f}function ja(f,h,q){var n;return function(){var l=this,p=arguments,r=q&&!n;clearTimeout(n);n=setTimeout(function(){n=null;q||f.apply(l,p)},h);r&&f.apply(l,p)}}function r(f){return f&&f.parentNode.removeChild(f)}function v(f){return f&&f.nodeType==Node.TEXT_NODE}function w(f,h){var q=[];for(f=f.firstChild;f;)h&&!h(f)||q.push(f),f=f.nextSibling;return q}function l(){var f;if("undefined"!=typeof window.getSelection){var h=
window.getSelection();h.rangeCount&&(f=h.getRangeAt(0))}else(h=document.selection)&&"Control"!=h.type&&(f=h.createRange());return f}function G(f){if(f)if(window.getSelection){var h=window.getSelection();0<h.rangeCount&&h.removeAllRanges();h.addRange(f)}else document.createRange?window.getSelection().addRange(f):document.selection&&f.select()}function la(f){return f.match(/([^,\s\.]+)|[,\s\.]+/ig)}var ma={66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"};return function(f,
h){var q,n,U,V="";h=h||{};var ka=h.ignoreReturnKey||!1,H=h.decorator||function(a,b){},na=h.splitter||la,oa=h.afterSelection||function(a){},pa=h.onMenuClick||function(){},W=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)W(a[c],b);else for(c=0;c<b.length;c++){var d=b[c];if("clear"==d)a.setAttribute("style","");else if(d.match(/^list(\s+\w+(-\w+)*){1}/))switch(d=d.split(/\s+/)[1],d){case "clear":break;case "indent":I(a);break;case "outdent":J(a);break;default:I(a,d)}}},X=function(a,b,c){if(Array.isArray(a))for(var d=
0;d<a.length;d++)X(a[d],b,c);else for(d=0;d<c.length;d++){var e=c[d].split(/\s*:\s*/),g=e[0],f=e[1];e=a.style.getPropertyValue(g);"autotagjsUnset"==b||"autotagjsToggle"==b&&0<e.length?a.style.removeProperty(g):"autotagjsSet"==b||("autotagjsInitialize"==b||"autotagjsToggle"==b)&&0===e.length?a.style.setProperty(g,f):b.match(/^autotagjs(Increment|Decrement)/)&&(e=e||getComputedStyle(a).getPropertyValue(g),f=parseInt(f&&f.match(/^[-]*[0-9]+/)[0]||0),e=parseInt(e&&e.match(/^[-]*[0-9]+/)[0]||0),"autotagjsIncrement"==
b?e+=f:"autotagjsDecrement"==b&&(e-=f),0>=e?a.style.removeProperty(g):a.style.setProperty(g,e+"px"))}},K=function(a,b,c,d,e){var g=document.createElement("div");b="hsla("+b+", "+c+"%, "+d+"%, 1.0)";g.className="autotagjs-palette-cell";g.style.background=b;g.dataset.autotagjsPaletteColor=b;if(e){e=g.dataset;b=g.style.background.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);for(c=1;c<b.length;c++)b[c]/=255,b[c]=.03928>=b[c]?b[c]/12.92:Math.pow((b[c]+.055)/1.055,2.4);e.autotagjsPaletteContrastColor=
.179<.2126*b[1]+.7152*b[2]+.0722*b[3]?"#000":"#FFF"}return a.appendChild(g)},Y=function(a){var b=document.createElement("div");b.className="autotagjs-palette-row";return a.appendChild(b)},x=function(a,b){b=b||{};var c=document.createElement("div");if(a&&(b.asSibling?a.parentNode.insertBefore(c,a.nextSibling):b.asPreviousSibling?a.parentNode.insertBefore(c,a):a.appendChild(c),b.addPilotNode)){var d=y("\u200b");c.appendChild(d);d.style.display="inline";b.setCaret&&k(d)}return c},y=function(a,b){var c=
document.createElement("span");if("string"===typeof a){var d=(d=a)&&d.replace(/ /g,"\u00a0")||"";d=document.createTextNode(d)}else v(a)&&(d=a);d&&c.appendChild(d);c.setAttribute("style",b||V);return c},Z=function(){var a=l(),b=a.endContainer;t(b)?k(b.lastChild,0):m(b)&&(b=b.querySelectorAll("span"),0<b.length&&k((b[a.endOffset-1]||b[b.length-1]).lastChild))},L=function(a){a=w(f,m);if(0==a.length)x(f,{addPilotNode:!0,setCaret:!0});else for(var b=0;b<a.length;b++)a[b].hasChildNodes()||r(a[b])},aa=function(a){if(n&&
a){switch(a.autotagjsScope){case "line":var b=A(n,NodeFilter.SHOW_ELEMENT,m);break;case "selection":b=z(n);var c=A(n,NodeFilter.SHOW_ELEMENT,m);b=1<c.length||b.length==B(M()).length?b.concat(c):b;break;default:b=z(n)}b=b.filter(Boolean);for(var d in a)if(a.hasOwnProperty(d)){c=b;var e=d,g=a[d].split(/\s*;\s*/);"autotagjsCommand"==e?W(c,g):"autotagjsCallback"==e?pa(g,c):X(c,e,g)}G(n)}},M=function(a){return(a=a||l())&&C(a.startContainer,!1)},D=function(a){for(var b=0;(a=a.parentNode)&&!u(a);)b++;return 0==
b?null:b%3||3},C=function(a,b){for(;a&&!u(a)&&(b||!m(a));)a=a.parentNode;return m(a)?a:f.querySelector("div:first-child")},N=function(a){if(u(a))return"autotagjs";var b=a.className.match(/(\w+(-\w+)*)-list-\d+/);return(b=b&&b[1])?b:N(a.parentNode)},ba=function(a,b,c){var d=[];do{var e=a.currentNode;b&&!b(e)||d.push(e)}while(a.nextNode()&&(!c||d.length<=c));return d},A=function(a,b,c){a=qa(a,b,c);return ba(a,c)},ca=function(a){return{startContainer:a.startContainer,endContainer:a.endContainer,startOffset:a.startOffset,
endOffset:a.endOffset}},qa=function(a,b,c){c=c||t;for(var d=a.commonAncestorContainer;!c(d)&&!m(d)&&!u(d);)d=d.parentNode;return da(d,b,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(ra){c.selectNodeContents(b)}b=-1==a.compareBoundaryPoints(Range.END_TO_START,c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})},O=function(a){if(v(a))return a.parentNode;if(t(a))return a;if(m(a))return B(a)[0]},B=function(a,b){if(b){var c=
da(a,NodeFilter.SHOW_ELEMENT);return ba(c,t)}return w(a,t)},z=function(a){return A(a,NodeFilter.SHOW_ELEMENT,t)},da=function(a,b,c){return document.createTreeWalker(a,b,function(a){return!c||c(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1)},I=function(a,b,c){if(!ea(a)){c=p(c,!0);b=p(b,N(a));var d=ca(n);if(P(a)||!u(a.parentNode)&&a.classList.contains("autotagjs-list"))Q(a,b,D(a),c);else{var e=a,g=l();e=p(e,g&&g.endContainer);C(e,!0);e=a.previousSibling;m(e)||(e=x(),a.parentNode.insertBefore(e,
a));E(e);e.appendChild(a);Q(a,b,D(a),c);b=w(a,m);for(c=0;c<b.length;c++)a.parentNode.insertBefore(b[c],a.nextSibling)}R(d)}},E=function(a){if(u(a.parentNode))return S(a,"autotagjs-list"),!0;a.classList.remove("autotagjs-list");return!1},T=function(a){if(a)return a=a.textContent,0==a.length||"\u200b"==a},F=function(a){return m(a)&&T(a)},P=function(a){return a.classList.contains("autotagjs-list-blank")},u=function(a){return a&&a.isSameNode(f)},m=function(a){return a&&"DIV"==a.tagName&&!u(a)},ea=function(a){return!u(a.parentNode)&&
!a.className.match(/(\w+(-\w+)*)-list(-.+)*/g)},t=function(a){return a&&"SPAN"==a.tagName},J=function(a,b){if(!ea(a)){b=p(b,!0);var c=a.parentNode;if(!E(a)){var d=ca(n);prefix=N(a);var e=w(a,m);if(0<e.length){var g=x();E(g);a.insertBefore(g,e[0]);for(var f=0;f<e.length;f++)g.appendChild(e[f])}for(;a.nextSibling;)a.appendChild(a.nextSibling);c.parentNode.insertBefore(a,c.nextSibling);e=D(c);Q(a,prefix,e,b);0==w(c,m)+w(c,t)&&r(c);R(d)}}},fa=function(){var a=l(),b=a.endContainer;if(v(b)){b.nodeValue.match(/^\u200b/)&&
(a.startContainer.nodeValue=a.startContainer.nodeValue.replace(/\u200b/g,""),a=k(b,a.endOffset+1));a=a.endOffset;var c=b.parentNode,d=na(b.nodeValue||"");d=d&&d.filter(Boolean)||"";var e=d.length;if(1<e){for(var g,f=0;f<e;f++)g=y(d[f],c.getAttribute("style")),g.style.display="inline-block",H(g,g.firstChild.nodeValue),c.parentNode.insertBefore(g,c.nextSibling),c=d[f].length,0<a&&a<=c&&k(g.firstChild,a),a-=c,c=g;r(b.parentNode)}else c.style.display="inline-block",H(c,c.firstChild.nodeValue)}else t(b)&&
v(b.firstChild)&&H(b,b.firstChild.nodeValue)},ha=function(){var a=l();if(a&&9!=a.startContainer.nodeType)return n=l()||n},k=function(a,b){if(a)return t(a)&&(a=a.firstChild),b=p(b,a.length),R({startContainer:a,startOffset:b,endContainer:a,endOffset:b})},R=function(a){var b=a.startContainer,c=a.endContainer;if(b&&c){var d=p(a.startOffset,0);a=p(a.endOffset,c.length);var e=document.createRange();try{e.setStart(b,d),e.setEnd(c,a),n=e}catch(g){}G(e)}return e},ia=function(a,b){return(T(a)||0==b)&&!a.previousSibling},
Q=function(a,b,c,d){d=p(d,!0);E(a)||(a.parentNode.style.setProperty("counter-reset",b+"-counter-"+c),a.style.setProperty("counter-reset",b+"-counter-"+(c+1)),b&&c&&(d||!P(a))&&S(a,b+"-list-"+c))},S=function(a,b){a.className=a.className.replace(/(\w+(-\w+)*)-list(-.+)*/g,"");a.classList.add(b)};f.addEventListener("dblclick",function(a){ha()});f.addEventListener("click",function(a){q&&(q.style.display="none");L();Z()});f.addEventListener("focus",function(a){L()});f.addEventListener("input",function(){fa()});
f.addEventListener("keydown",function(a){Z();var b=p(void 0,M());var c;if(m(b))for(c=1;b=b.previousSibling;)c++;var d=l(),e=a.which||a.keyCode||0;if(8==e||9==e){a:{c=a.shiftKey;if(d.collapsed){var g=d.startContainer;b=d.startOffset;d=M();if(ia(O(g),b)&&D(d)){9==e?c?J(d,!1):I(d,null,!1):8==e&&(P(d)?J(d,!1):S(d,"autotagjs-list-blank"));break a}if(9==e){d=v(g)?g.parentNode:g;if(t(d)&&!c){g=d.textContent;c=d.parentNode;var f=d.nextSibling;e=y("    ");0===b?(c.insertBefore(e,d),k(d.firstChild,0)):b===
d.firstChild.length?(c.insertBefore(e,f),f?k(f.firstChild,0):k(e.firstChild,1)):(d.textContent=g.substring(0,b),c.insertBefore(e,f),b=y(g.substring(b)),c.insertBefore(b,e.nextSibling),k(b.firstChild,0))}break a}}if(8==e)if(c=l(),b=c.startOffset,d=c.startContainer,c.collapsed){d=c=O(d);if(0==b||T(c))d=d.previousSibling;if(d&&t(d))c=d,d=c.textContent,e=c.firstChild,b=p(b||null,d.length),e.nodeValue=d.slice(0,b-1)+d.slice(b),0==e.nodeValue.length&&1==b?c.previousSibling?(k(c.previousSibling),r(c)):(e.nodeValue=
"\u200b",c.style.display="inline",k(c)):k(e,b-1);else if(b=C(c),(d=b.previousSibling)&&m(d))if(c=B(d,!0),c=c[c.length-1],F(d))r(d);else if(F(b))k(c),r(b);else{k(c);d=B(b);for(e=0;e<d.length;e++)c.parentNode.insertBefore(d[e],c.nextSibling),c=d[e];F(b)&&r(b)}}else{b=z(c);for(d=0;b&&d<b.length;d++)r(b[d]);b=A(c,NodeFilter.SHOW_ELEMENT,m);for(c=0;c<b.length;c++)F(b[c])&&r(b[c]);L()}}a.preventDefault()}else if(13==e){if(!ka&&d.collapsed){e=d.startContainer;g=d.startOffset;b=C(e);c=O(e);if(c.nextSibling||
g!=c.textContent.length)if(ia(c,g))d=x(b,{asPreviousSibling:!0,addPilotNode:!0,setCaret:!0});else{e=e.splitText(d.startOffset);g=y(r(e));d=x(b,{asSibling:!0});d.appendChild(g);k(e,0);for(e=[];c=c.nextSibling;)e.push(c);c=g;for(g=0;g<e.length;g++)c=c.parentNode.insertBefore(e[g],c.nextSibling)}else d=x(b,{asSibling:!0,addPilotNode:!0,setCaret:!0});d.style=b.style;d.className=b.className}a.preventDefault()}else!a.metaKey||66!=e&&73!=e&&85!=e||(aa({autotagjsToggle:ma[e]}),a.preventDefault())});f.addEventListener("keyup",
function(a){});f.addEventListener("paste",function(a){a.preventDefault();var b;a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));a=l().endContainer;u(a)&&(a=l().endContainer);v(a)?(a.nodeValue+=b,k(a)):(b=document.createTextNode(b),a.insertBefore(b,a.firstChild),k(b));fa()});document.addEventListener("selectionchange",ja(function(a){ha()&&((a=l())&&(a=z(a).pop())&&(V=a.getAttribute("style")),oa(z(n)))},200));return{attachMenubar:function(a){a&&
(U=a,U.addEventListener("click",function(a){G(n);a=a.target;var b=a.parentNode;if(b.classList.contains("autotagjs-menu"))a=b;else if(a.classList.contains("autotagjs-palette-cell")){var d=q.parentNode.dataset.autotagjsPalette;b=a.dataset;if(!b.autotagjsSet){var e=b.autotagjsPaletteColor;if("color"==d)var f="color: "+e;else"fill"==d&&(f="background-color: "+e,(d=b.autotagjsPaletteContrastColor)&&(f=f+"; color: "+d));b.autotagjsSet=f}}b=a;q&&(q.style.display="none");if(b.dataset.autotagjsPalette){f=
"fill"==b.dataset.autotagjsPalette;if(a=b.getElementsByClassName("autotagjs-submenu")[0])a.style.display="";else{a=document.createElement("div");a.classList.add("autotagjs-submenu");a.classList.add("autotagjs-palette");b.appendChild(a);d=Math.round(36);e=Math.round(8);for(var h=Math.round(16),k=0,m=100,l=94;5>k;k++,m-=e,l-=h){b=Y(a);for(var p=0,r=0;10>p;p++,r+=d)K(b,r,m,l,f)}b=Y(a);h=Math.round(100/9);k=0;for(l=h;9>k;k++,l+=h)K(b,0,0,l,f);b=K(b,0,0,100);b.classList.add("autotagjs-crossed-cell");f||
(b.dataset.autotagjsPaletteColor="#000")}q=a}else if(b.dataset.autotagjsSelect){if(q=b.getElementsByClassName("autotagjs-submenu")[0])f=window.getComputedStyle(q),q.style.display="none"===f.display?"":"none"}else aa(b.dataset)}))}}}}();
