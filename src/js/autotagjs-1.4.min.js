/*
 autotagjs.js v1.4 https://github.com/motorstreak/autotag */
var AutotagJS=function(){function l(f,g){return"undefined"===typeof f||null==f?g:f}function ja(f,g,m){var l;return function(){var p=this,q=arguments,u=m&&!l;clearTimeout(l);l=setTimeout(function(){l=null;m||f.apply(p,q)},g);u&&f.apply(p,q)}}function p(f){return f&&f.parentNode.removeChild(f)}function u(f){return f&&f.nodeType==Node.TEXT_NODE}function v(f,g){var m=[];for(f=f.firstChild;f;)g&&!g(f)||m.push(f),f=f.nextSibling;return m}function q(){var f;if("undefined"!=typeof window.getSelection){var g=
window.getSelection();g.rangeCount&&(f=g.getRangeAt(0))}else(g=document.selection)&&"Control"!=g.type&&(f=g.createRange());return f}function F(f){if(f)if(window.getSelection){var g=window.getSelection();0<g.rangeCount&&g.removeAllRanges();g.addRange(f)}else document.createRange?window.getSelection().addRange(f):document.selection&&f.select()}function la(f){return f.match(/([^,\s\.]+)|[,\s\.]+/ig)}var ma={66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"};return function(f,
g){var m,U,V="";g=g||{};var ka=g.ignoreReturnKey||!1,E=g.decorator||function(a,b){},na=g.splitter||la,oa=g.afterSelection||function(a){},pa=g.onMenuClick||function(){},W=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)W(a[c],b);else for(c=0;c<b.length;c++){var d=b[c];if("clear"==d)a.setAttribute("style","");else if(d.match(/^list(\s+\w+(-\w+)*){1}/))switch(d=d.split(/\s+/)[1],d){case "clear":break;case "indent":G(a);break;case "outdent":H(a);break;default:G(a,d)}}},X=function(a,b,c){if(Array.isArray(a))for(var d=
0;d<a.length;d++)X(a[d],b,c);else for(d=0;d<c.length;d++){var e=c[d].split(/\s*:\s*/),h=e[0],f=e[1];e=a.style.getPropertyValue(h);"atgUnset"==b||"atgToggle"==b&&0<e.length?a.style.removeProperty(h):"atgSet"==b||("atgInitialize"==b||"atgToggle"==b)&&0===e.length?a.style.setProperty(h,f):b.match(/^atg(Increment|Decrement)/)&&(e=e||getComputedStyle(a).getPropertyValue(h),f=parseInt(f&&f.match(/^[-]*[0-9]+/)[0]||0),e=parseInt(e&&e.match(/^[-]*[0-9]+/)[0]||0),"atgIncrement"==b?e+=f:"atgDecrement"==b&&
(e-=f),0>=e?a.style.removeProperty(h):a.style.setProperty(h,e+"px"))}},I=function(a,b,c,d,e){var h=document.createElement("div");b="hsla("+b+", "+c+"%, "+d+"%, 1.0)";h.className="atg-palette-cell";h.style.background=b;h.dataset.atgPaletteColor=b;if("highlight"===e){e=h.dataset;b=h.style.background.match(/[.?\d]+/g);for(c=0;3>c;c++)b[c]/=255,b[c]=.03928>=b[c]?b[c]/12.92:Math.pow((b[c]+.055)/1.055,2.4);e.atgPaletteContrastColor=.179<.2126*b[0]+.7152*b[1]+.0722*b[2]?"#000":"#FFF"}return a.appendChild(h)},
Y=function(a){var b=document.createElement("div");b.className="atg-palette-row";return a.appendChild(b)},w=function(a,b){b=b||{};var c=document.createElement("div");if(a&&(b.asSibling?a.parentNode.insertBefore(c,a.nextSibling):b.asPreviousSibling?a.parentNode.insertBefore(c,a):a.appendChild(c),b.addPilotNode)){var d=x("\u200b");c.appendChild(d);d.style.display="inline";b.setCaret&&k(d)}return c},x=function(a,b){var c=document.createElement("span");if("string"===typeof a){var d=(d=a)&&d.replace(/ /g,
"\u00a0")||"";d=document.createTextNode(d)}else u(a)&&(d=a);d&&c.appendChild(d);c.setAttribute("style",b||V);return c},Z=function(){var a=q(),b=a.endContainer;r(b)?k(b.lastChild,0):n(b)&&(b=b.querySelectorAll("span"),0<b.length&&k((b[a.endOffset-1]||b[b.length-1]).lastChild))},J=function(a){a=v(f,n);if(0==a.length)w(f,{addPilotNode:!0,setCaret:!0});else for(var b=0;b<a.length;b++)a[b].hasChildNodes()||p(a[b])},aa=function(a,b){if(m&&a){var c=K(m,NodeFilter.SHOW_ELEMENT,n);switch(b){case "line":1<
c.length&&n(m.commonAncestorContainer)&&c.shift();break;case "selection":var d=y(m),e=z(L());c=1<c.length||d.length==e.length?d.concat(c):d;break;default:c=y(m)}c=c.filter(Boolean);for(var h in a)if(a.hasOwnProperty(h)){d=c;e=h;var f=a[h].split(/\s*;\s*/);"atgCommand"==e?W(d,f):"atgCallback"==e?pa(f,d):X(d,e,f)}F(m)}},L=function(){var a=m;return a&&A(a.startContainer,!1)},B=function(a){for(var b=0;(a=a.parentNode)&&!t(a);)b++;return 0==b?null:b%3||3},A=function(a,b){for(;a&&!t(a)&&(b||!n(a));)a=a.parentNode;
return n(a)?a:f.querySelector("div:first-child")},M=function(a){if(t(a))return"atg";var b=a.className.match(/(\w+(-\w+)*)-list-\d+/);return(b=b&&b[1])?b:M(a.parentNode)},ba=function(a,b,c){var d=[];do{var e=a.currentNode;b&&!b(e)||d.push(e)}while(a.nextNode()&&(!c||d.length<=c));return d},K=function(a,b,c){a=qa(a,b,c);return ba(a,c)},ca=function(a){return{startContainer:a.startContainer,endContainer:a.endContainer,startOffset:a.startOffset,endOffset:a.endOffset}},qa=function(a,b,c){c=c||r;for(var d=
a.commonAncestorContainer;!c(d)&&!n(d)&&!t(d);)d=d.parentNode;return da(d,b,function(b){if(a.intersectsNode)b=a.intersectsNode(b);else{var c=b.ownerDocument.createRange();try{c.selectNode(b)}catch(ra){c.selectNodeContents(b)}b=-1==a.compareBoundaryPoints(Range.END_TO_START,c)&&1==a.compareBoundaryPoints(Range.START_TO_END,c)}return b})},N=function(a){if(u(a))return a.parentNode;if(r(a))return a;if(n(a))return z(a)[0]},z=function(a,b){if(b){var c=da(a,NodeFilter.SHOW_ELEMENT);return ba(c,r)}return v(a,
r)},y=function(a){return K(a,NodeFilter.SHOW_ELEMENT,r)},da=function(a,b,c){return document.createTreeWalker(a,b,function(a){return!c||c(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1)},O=function(){for(var a=menubar.querySelectorAll(".atg-submenu"),b=0;b<a.length;b++)a[b].style.display="none"},G=function(a,b,c){if(!ea(a)){c=l(c,!0);b=l(b,M(a));var d=ca(m);if(P(a)||!t(a.parentNode)&&a&&a.classList.contains("atg-list"))Q(a,b,B(a),c);else{var e=a,h=q();e=l(e,h&&h.endContainer);A(e,!0);e=a.previousSibling;
n(e)||(e=w(),a.parentNode.insertBefore(e,a));C(e);e.appendChild(a);Q(a,b,B(a),c);b=v(a,n);for(c=0;c<b.length;c++)a.parentNode.insertBefore(b[c],a.nextSibling)}R(d)}},C=function(a){if(t(a.parentNode))return S(a,"atg-list"),!0;a.classList.remove("atg-list");return!1},T=function(a){if(a)return a=a.textContent,0==a.length||"\u200b"==a},D=function(a){return n(a)&&T(a)},P=function(a){return a&&a.classList.contains("atg-list-blank")},t=function(a){return a&&a.isSameNode(f)},n=function(a){return a&&"DIV"==
a.tagName&&!t(a)},ea=function(a){return a&&!t(a.parentNode)&&!a.className.match(/(\w+(-\w+)*)-list(-.+)*/g)},r=function(a){return a&&"SPAN"==a.tagName},H=function(a,b){if(!ea(a)){b=l(b,!0);var c=a.parentNode;if(!C(a)){var d=ca(m);prefix=M(a);var e=v(a,n);if(0<e.length){var h=w();C(h);a.insertBefore(h,e[0]);for(var f=0;f<e.length;f++)h.appendChild(e[f])}for(;a.nextSibling;)a.appendChild(a.nextSibling);c.parentNode.insertBefore(a,c.nextSibling);e=B(c);Q(a,prefix,e,b);0==v(c,n)+v(c,r)&&p(c);R(d)}}},
fa=function(){var a=q(),b=a.endContainer;if(u(b)){var c=b.nodeValue;c.match(/^\u200b/)&&(b.nodeValue=c.replace(/\u200b/g,""),a=k(b,a.endOffset+1));a=a.endOffset;var d=b.parentNode;c=(c=na(b.nodeValue||""))&&c.filter(Boolean)||"";var e=c.length;if(1<e){for(var f,g=0;g<e;g++)f=x(c[g],d.getAttribute("style")),f.style.removeProperty("display"),E(f,f.firstChild.nodeValue),d.parentNode.insertBefore(f,d.nextSibling),d=c[g].length,0<a&&a<=d&&k(f.firstChild,a),a-=d,d=f;p(b.parentNode)}else d.style.removeProperty("display"),
E(d,d.firstChild.nodeValue)}else r(b)&&u(b.firstChild)&&E(b,b.firstChild.nodeValue)},ha=function(){var a=q();if(a&&9!=a.startContainer.nodeType)return m=q()||m},k=function(a,b){if(a)return r(a)&&(a=a.firstChild),b=l(b,a.length),R({startContainer:a,startOffset:b,endContainer:a,endOffset:b})},R=function(a){var b=a.startContainer,c=a.endContainer;if(b&&c){var d=l(a.startOffset,0);a=l(a.endOffset,c.length);var e=document.createRange();try{e.setStart(b,d),e.setEnd(c,a),m=e}catch(h){}F(e)}return e},ia=
function(a,b){return(T(a)||0==b)&&!a.previousSibling},Q=function(a,b,c,d){d=l(d,!0);C(a)||(a.parentNode.style.setProperty("counter-reset",b+"-counter-"+c),a.style.setProperty("counter-reset",b+"-counter-"+(c+1)),b&&c&&(d||!P(a))&&S(a,b+"-list-"+c))},S=function(a,b){a.className=a.className.replace(/(\w+(-\w+)*)-list(-.+)*/g,"");a.classList.add(b)};f.addEventListener("dblclick",function(a){ha()});f.addEventListener("click",function(a){O();J();Z()});f.addEventListener("focus",function(a){J()});f.addEventListener("input",
function(){fa()});f.addEventListener("keydown",function(a){Z();var b=l(void 0,L());var c;if(n(b))for(c=1;b=b.previousSibling;)c++;var d=q(),e=a.which||a.keyCode||0;if(8==e||9==e){a:{c=a.shiftKey;if(d.collapsed){var f=d.startContainer;b=d.startOffset;d=L();if(ia(N(f),b)&&B(d)){9==e?c?H(d,!1):G(d,null,!1):8==e&&(P(d)?H(d,!1):S(d,"atg-list-blank"));break a}if(9==e){d=u(f)?f.parentNode:f;if(r(d)&&!c){f=d.textContent;c=d.parentNode;var g=d.nextSibling;e=x("    ");0===b?(c.insertBefore(e,d),k(d.firstChild,
0)):b===d.firstChild.length?(c.insertBefore(e,g),g?k(g.firstChild,0):k(e.firstChild,1)):(d.textContent=f.substring(0,b),c.insertBefore(e,g),b=x(f.substring(b)),c.insertBefore(b,e.nextSibling),k(b.firstChild,0))}break a}}if(8==e)if(c=q(),b=c.startOffset,d=c.startContainer,c.collapsed){d=c=N(d);if(0==b||T(c))d=d.previousSibling;if(d&&r(d))c=d,d=c.textContent,e=c.firstChild,b=l(b||null,d.length),e.nodeValue=d.slice(0,b-1)+d.slice(b),0==e.nodeValue.length&&1==b?c.previousSibling?(k(c.previousSibling),
p(c)):(e.nodeValue="\u200b",c.style.display="inline",k(c)):k(e,b-1);else if(b=A(c),(d=b.previousSibling)&&n(d))if(c=z(d,!0),c=c[c.length-1],D(d))p(d);else if(D(b))k(c),p(b);else{k(c);d=z(b);for(e=0;e<d.length;e++)c.parentNode.insertBefore(d[e],c.nextSibling),c=d[e];D(b)&&p(b)}}else{b=y(c);for(d=0;b&&d<b.length;d++)p(b[d]);b=K(c,NodeFilter.SHOW_ELEMENT,n);for(c=0;c<b.length;c++)D(b[c])&&p(b[c]);J()}}a.preventDefault()}else if(13==e){if(!ka&&d.collapsed){e=d.startContainer;f=d.startOffset;b=A(e);c=
N(e);if(c.nextSibling||f!=c.textContent.length)if(ia(c,f))d=w(b,{asPreviousSibling:!0,addPilotNode:!0,setCaret:!0});else{e=e.splitText(d.startOffset);f=x(p(e));d=w(b,{asSibling:!0});d.appendChild(f);k(e,0);for(e=[];c=c.nextSibling;)e.push(c);c=f;for(f=0;f<e.length;f++)c=c.parentNode.insertBefore(e[f],c.nextSibling)}else d=w(b,{asSibling:!0,addPilotNode:!0,setCaret:!0});d.style=b.style;d.className=b.className}a.preventDefault()}else!a.metaKey||66!=e&&73!=e&&85!=e||(aa({atgToggle:ma[e]}),a.preventDefault())});
f.addEventListener("keyup",function(a){});f.addEventListener("paste",function(a){a.preventDefault();var b;a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));a=q().endContainer;t(a)&&(a=q().endContainer);u(a)?(a.nodeValue+=b,k(a)):(b=document.createTextNode(b),a.insertBefore(b,a.firstChild),k(b));fa()});document.addEventListener("selectionchange",ja(function(a){ha()&&((a=q())&&(a=y(a).pop())&&(V=a.getAttribute("style")),
oa(y(m)))},200));return{attachMenubar:function(a){a&&(U=a,U.addEventListener("click",function(a){O();F(m);a=a.target;var b;a:for(b=a;!b.classList.contains("atg-submenu")&&!b.classList.contains("atg-menu");)if(b=b.parentNode,t(b)){b=void 0;break a}var d=b.querySelector(".atg-submenu");if(d){var e=d;a=window.getComputedStyle(e);e.style.display="none"===a.display?"":"none"}else if(d=b.dataset.atgSubmenu){if(d.match(/Palette$/))if(e=d.split("Palette")[0],a=b.getElementsByClassName("atg-submenu")[0])a.style.display=
"";else{a=document.createElement("div");a.classList.add("atg-submenu");a.classList.add("atg-palette");a.dataset.atgPalette=e;b.appendChild(a);d=Math.round(36);for(var f=Math.round(8),g=Math.round(16),k=0,n=100,l=94;5>k;k++,n-=f,l-=g){b=Y(a);for(var p=0,q=0;10>p;p++,q+=d)I(b,q,n,l,e)}b=Y(a);g=Math.round(100/9);k=0;for(l=g;9>k;k++,l+=g)I(b,0,0,l,e);a=I(b,0,0,100);a.classList.add("atg-crossed-cell");"color"===e&&(a.dataset.atgPaletteColor="#000")}}else b.dataset.atgPalette&&(f=b.dataset.atgPalette,d=
a.dataset,d.atgSet||(g=d.atgPaletteColor,"color"===f?e="color: "+g:"highlight"===f&&(e="background-color: "+g,(f=d.atgPaletteContrastColor)&&(e=e+"; color: "+f)),d.atgSet=e)),aa(a.dataset,b.dataset.atgScope),O()}))}}}}();
