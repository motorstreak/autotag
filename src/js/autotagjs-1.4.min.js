/* autotagjs.js v1.4 https://github.com/motorstreak/autotag */ var Autotag=Autotag||{},Autotag=function(){return function(e,k){function M(a,b,d){var f;return function(){var c=this,h=arguments,u=d&&!f;clearTimeout(f);f=setTimeout(function(){f=null;d||a.apply(c,h)},b);u&&a.apply(c,h)}}var v,N,r,A,O,ca={66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"};k=k||{};var P=k.ignoreReturnKey||!1,da=k.trace||!1,E=k.decorator||function(a,b){},ea=k.onReturnKey||function(){},fa=k.splitter||function(a){return a.match(/([^,\s\.]+)|[,\s\.]+/ig)},ga=
k.afterKeypress||function(){},ha=k.afterSelection||function(a){},ia=k.onMenuClick||function(){},Q=function(){var a=document.createElement("autotag");a.appendChild(document.createElement("br"));A&&a.setAttribute("style",A);return a},R=function(a,b,d,f){var c=document.createElement("div");c.className="autotagjs-palette-cell";c.style.color=c.style.background="hsla("+b+", "+d+"%, "+f+"%, 1.0)";a.appendChild(c)},S=function(a){var b=document.createElement("div");b.className="autotagjs-palette-row";return a.appendChild(b)},
B=function(a){var b=document.createElement("autotag");a&&b.appendChild(ja(a));return b},ja=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},U=function(){var a=g(),b=a.endContainer;b==a.startContainer&&(T(b)?l(b,0):m(b)?l(b.lastChild,0):n(b)&&(b=b.querySelectorAll("autotag"),0<b.length&&l((b[a.endOffset-1]||b[b.length-1]).lastChild)))},x=function(a){if("undefined"===typeof a&&e.querySelector("p:first-child")){a=e.childNodes;for(var b=0;b<a.length;b++)"P"!==a[b].tagName&&
F(a[b])}else V(e),a=document.createElement("p"),e.appendChild(a),l(a.appendChild(Q()),0)},y=function(a){a="undefined"===typeof a?p():a;if(n(a))if(0===a.textContent.length)V(a),l(a.appendChild(Q()),0);else{var b=a,b="undefined"===typeof b?p():b;n(b)&&G(b&&b.querySelectorAll("br"))}return a},J=function(a){if(r&&a){switch(a.autotagjsScope){case "line":var b=W(r);break;case "selection":b=H(r);var d=W(r),f;if(!(f=1<d.length)){f=b.length;var c=void 0;c="undefined"===typeof c?p():c;c=n(c)&&c.getElementsByTagName("autotag");
f=f==c.length}b=f?b.concat(d):b;break;default:b=H(r)}b=b.filter(Boolean);for(var h in a)if(a.hasOwnProperty(h))if(d=b,f=h,c=a[h].split(/\s*;\s*/),"autotagjsCallback"==f)ia(c,d);else for(var u=0;u<d.length;u++)if("autotagjsCommand"==f)for(var e=d[u],t=c,g=0;g<t.length;g++)"clear"==t[g]&&(A=null,e.setAttribute("style",""));else for(var e=d[u],t=f,g=c,l=0;l<g.length;l++){var q=g[l].split(/\s*:\s*/),k=q[0],m=q[1],q=e.style.getPropertyValue(k);"autotagjsUnset"==t||"autotagjsToggle"==t&&0<q.length?e.style.removeProperty(k):
"autotagjsSet"==t||("autotagjsInitialize"==t||"autotagjsToggle"==t)&&0===q.length?e.style.setProperty(k,m):t.match(/^autotagjs(Increment|Decrement)/)&&(q=q||getComputedStyle(e).getPropertyValue(k),m=parseInt(m&&m.match(/^[-]*[0-9]+/)[0]||0),q=parseInt(q&&q.match(/^[-]*[0-9]+/)[0]||0),"autotagjsIncrement"==t?q+=m:"autotagjsDecrement"==t&&(q-=m),0>=q?e.style.removeProperty(k):e.style.setProperty(k,q+"px"))}I(r)}},p=function(a){for(a="undefined"===typeof a?g()&&g().endContainer:a;a&&!C(a)&&!n(a);)a=
a.parentNode;return n(a)?a:e.querySelector("p:first-child")},X=function(a){a="undefined"===typeof a?p():a;var b;if(n(a))for(b=1;a=a.previousSibling;)b++;return b},W=function(a){var b=p(a.startContainer);a=p(a.endContainer);for(var d=[b];b&&b!==a;)d.push(b=b.nextSibling);return d},D=function(a){if(a&&!C(a)){if(n(a))var b=a.firstChild;else if(m(a)||a&&"DIV"==a.tagName)b=a.nextSibling||D(a.parentNode.nextSibling);b||(b=D(a.parentNode.nextSibling));T(b)&&(b=D(b.parentNode.nextSibling))}return b},g=function(){var a;
if("undefined"!=typeof window.getSelection){var b=window.getSelection();0<b.rangeCount&&(a=b.getRangeAt(0))}else(b=document.selection)&&"Control"!=b.type&&(a=b.createRange());return a},Y=function(a,b){return a.querySelector("a:nth-child("+("undefined"===typeof b||0>b?0:b)+")")},H=function(a){var b=a.startContainer;b=n(b)&&Y(b,a.startOffset+1)||m(b)&&b||w(b)&&b.parentNode;var d=a.endContainer;a=n(d)&&Y(d,a.endOffset)||m(d)&&d||w(d)&&d.parentNode;for(d=b&&[b]||[];b&&b!==a;)d.push(b=D(b));return d},
Z=function(a){n(a)&&l(a.querySelector("a:first-child"),0)},T=function(a){var b;if(b=m(a))b=(a=a.lastChild)&&"BR"==a.tagName;return b},C=function(a){return a&&a.isSameNode(e)},n=function(a){return a&&"P"==a.tagName},m=function(a){return a&&"AUTOTAG"==a.tagName},w=function(a){return a&&a.nodeType==Node.TEXT_NODE},z=function(a,b){a="undefined"===typeof a?e:a;"undefined"!==typeof b&&G(a.querySelectorAll("div"));if(n(a))for(var d=a.querySelectorAll("autotag"),f=0;f<d.length;f++){var c=d[f];if(c){var h=
parseFloat;var u=c&&"font-size"&&window.getComputedStyle(c,null).getPropertyValue("font-size");h=h(u);c.getBoundingClientRect().height>1.3*h&&(c.previousSibling&&"DIV"===c.previousSibling.tagName||c.parentNode.insertBefore(document.createElement("div"),c))}}},K=function(){v&&(v.style.display="none")},aa=function(a){K();if(a.dataset.autotagjsPalette){var b=a.getElementsByClassName("autotagjs-submenu")[0];if(b)b.style.display="";else{b=document.createElement("div");b.className="autotagjs-submenu autotagjs-palette";
a.appendChild(b);for(var d=Math.round(36),f=Math.round(8),c=Math.round(16),h=0,e=100,g=94;5>h;h++,e-=f,g-=c){a=S(b);for(var k=0,l=0;10>k;k++,l+=d)R(a,l,e,g)}a=S(b);c=Math.round(10);h=0;for(g=10;10>h;h++,g+=c)R(a,0,0,g)}v=b}else if(a.dataset.autotagjsSelect){if(v=a.getElementsByClassName("autotagjs-submenu")[0])b=window.getComputedStyle(v),v.style.display="none"===b.display?"":"none"}else J(a.dataset),z(p(),!0)},L=function(){var a=g(),b=a.endContainer;if(w(b)){var a=a.endOffset,d=b,f=a,f="undefined"===
typeof f?0:f,d="undefined"===typeof d?g().endContainer:d;if(w(d)){var c=d.parentNode;if(n(c)){var h=B();c.insertBefore(h,d);h.appendChild(d);l(d,f)}else m(c)&&G(c&&c.querySelectorAll("br"))}var e=b.parentNode,d=(d=fa(b.nodeValue||""))&&d.filter(Boolean)||"",f=d.length;da&&console.log("TRACE : splitter : "+d);if(1<f){e.style.display="none";for(h=0;h<f;h++)c=B(d[h]),c.setAttribute("style",e.getAttribute("style")),c.style.display="inline",E(c,c.firstChild.nodeValue),e.parentNode.insertBefore(c,e.nextSibling),
e=d[h].length,0<a&&a<=e&&l(c.firstChild,a),a-=e,e=c;F(b.parentNode)}else E(e,e.firstChild.nodeValue)}else m(b)&&w(b.firstChild)&&E(b,b.firstChild.nodeValue)},ba=function(){y();L();z(p(),!0)},V=function(a){for(;a&&a.hasChildNodes();)a.removeChild(a.lastChild);return a},F=function(a){return a&&a.parentNode&&a.parentNode.removeChild(a)},G=function(a){for(var b=0;a&&b<=a.length;b++)F(a[b]);return a},I=function(a){if(a)if(window.getSelection){var b=window.getSelection();0<b.rangeCount&&b.removeAllRanges();
b.addRange(a)}else document.createRange?window.getSelection().addRange(a):document.selection&&a.select();return a},l=function(a,b){var d=b="undefined"===typeof b?a.length:b,f=b;if(a&&a){d="undefined"===typeof d?0:d;f="undefined"===typeof f?a.length:f;var c=document.createRange();try{c.setStart(a,d),c.setEnd(a,f),r=c}catch(h){}I(c)}return c};document.addEventListener("selectionchange",M(function(a){r=g();ha(H(r))},500));e.addEventListener("dblclick",function(a){r=g()});e.addEventListener("click",function(a){K();
y();x()});e.addEventListener("focus",function(a){r=g();x()});e.addEventListener("textinput",ba);e.addEventListener("textInput",ba);e.addEventListener("keydown",function(a){N=X();var b=a.which||a.keyCode||0;if(8==b)U();else if(13==b)P?(a.preventDefault(),ea()):(a=g().endContainer,(a=m(a)&&a||w(a)&&a.parentNode)&&(A=a.getAttribute("style")));else if(9==b){if(a.preventDefault(),b=g(),a=b.endContainer.parentNode,b.startContainer==b.endContainer&&b.startOffset==b.endOffset&&m(a)){var d=b.endOffset,f=a.textContent,
b=a.parentNode,c=a.nextSibling,e=B("    ");0===d?(b.insertBefore(e,a),l(a.firstChild,0)):d===a.firstChild.length?c&&(b.insertBefore(e,c),l(c.firstChild,0)):(a.textContent=f.substring(0,d),b.insertBefore(e,c),a=B(f.substring(d)),b.insertBefore(a,e.nextSibling),l(a.firstChild,0));z(p(),!0)}}else!a.metaKey||66!=b&&73!=b&&85!=b||(a.preventDefault(),J({autotagjsToggle:ca[b]}))});e.addEventListener("keyup",function(a){a=a.which||a.keyCode||0;if(8==a)C(g().endContainer)?x():y(),z(p(),!0);else if(13==a&&
!1===P){a=p();a.style.display="none";if(X(a)==N)a="undefined"===typeof a?p():a,a=n(a)&&a.nextSibling,null!==a&&(y(a),Z(a));else{var b=a;b="undefined"===typeof b?p():b;b=n(b)&&b.previousSibling;y(b);y(a);Z(a)}a.style.removeProperty("counter-reset");a.style.display="block";x();L();U()}ga()});e.addEventListener("paste",function(a){a.preventDefault();var b;a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));a=g().endContainer;
C(a)&&(x(!0),a=g().endContainer);w(a)?(a.nodeValue+=b,l(a)):(b=document.createTextNode(b),a.insertBefore(b,a.firstChild),l(b));L()});window.addEventListener("resize",M(function(a){z(p(),!0)},250));x();return{attachMenubar:function(a){a&&(O=a,O.addEventListener("click",function(a){I(r);a=a.target;if(a.classList.contains("autotagjs-menu")||a.parentNode.classList.contains("autotagjs-submenu"))aa(a);else if(a.parentNode.classList.contains("autotagjs-menu"))aa(a.parentNode);else if(a.classList.contains("autotagjs-palette-cell")){a=
a.style.backgroundColor;var b=v.parentNode.dataset,e;"color"==b.autotagjsPalette?e="color: "+a:"fill"==b.autotagjsPalette&&(e="background-color: "+a);b.autotagjsSet=e;J(b);K()}}))}}}}();
