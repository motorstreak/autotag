/*
 autotagjs.js v1.4 https://github.com/motorstreak/autotag */
var Autotag=Autotag||{};
Autotag=function(){return function(n,q){function L(a,b,d){var e;return function(){var c=this,f=arguments,h=d&&!e;clearTimeout(e);e=setTimeout(function(){e=null;d||a.apply(c,f)},b);h&&a.apply(c,f)}}var t,M,p,z,N,da={66:"font-weight:bold",73:"font-style:italic",85:"text-decoration:underline"};q=q||{};var O=q.ignoreReturnKey||!1,ea=q.trace||!1,C=q.decorator||function(a,b){},fa=q.onReturnKey||function(){},ha=q.splitter||function(a){return a.match(/([^,\s\.]+)|[,\s\.]+/ig)},ia=q.afterKeypress||function(){},
ja=q.afterSelection||function(a){},ka=q.onMenuClick||function(){},P=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)P(a[d],b);else for(d=0;d<b.length;d++){var e=b[d];if("clear"==e)z=null,a.setAttribute("style","");else if(e.match(/^list(\s+\w+(-\w+)*){1,2}/)){var c=e.split(/\s+/)[1],f=e.split(/\s+/)[2];e=p.startContainer;var h=p.endContainer,l=p.startOffset,m=p.endOffset,g=a.parentNode;var k=a.previousSibling;var q=a.className;a.setAttribute("class",q.replace(/(\w+-)+list\s*/g,""));if(x(g))for(null==
k&&(k=document.createElement("p"),n.insertBefore(k,a),k.appendChild(a)),f&&k.style.setProperty("counter-reset",f),a.style.removeProperty("counter-reset"),a.className+="autotagjs-list "+c,k.appendChild(a),c=Array.prototype.slice.call(a.children),g=0;g<c.length;g++)"P"==c[g].tagName&&k.appendChild(c[g]);else if(q.match(new RegExp(c,"g"))){for(;k=a.nextSibling;)a.appendChild(k);g.parentNode.insertBefore(a,g.nextSibling)}else a.className+="autotagjs-list "+c;Q(e,l,h,m)}}},R=function(a,b,d){if(Array.isArray(a))for(var e=
0;e<a.length;e++)R(a[e],b,d);else for(e=0;e<d.length;e++){var c=d[e].split(/\s*:\s*/),f=c[0],h=c[1];c=a.style.getPropertyValue(f);"autotagjsUnset"==b||"autotagjsToggle"==b&&0<c.length?a.style.removeProperty(f):"autotagjsSet"==b||("autotagjsInitialize"==b||"autotagjsToggle"==b)&&0===c.length?a.style.setProperty(f,h):b.match(/^autotagjs(Increment|Decrement)/)&&(c=c||getComputedStyle(a).getPropertyValue(f),h=parseInt(h&&h.match(/^[-]*[0-9]+/)[0]||0),c=parseInt(c&&c.match(/^[-]*[0-9]+/)[0]||0),"autotagjsIncrement"==
b?c+=h:"autotagjsDecrement"==b&&(c-=h),0>=c?a.style.removeProperty(f):a.style.setProperty(f,c+"px"))}},S=function(){var a=document.createElement("span");a.appendChild(document.createElement("br"));z&&a.setAttribute("style",z);return a},T=function(a,b,d,e){var c=document.createElement("div");c.className="autotagjs-palette-cell";c.style.color=c.style.background="hsla("+b+", "+d+"%, "+e+"%, 1.0)";a.appendChild(c)},U=function(a){var b=document.createElement("div");b.className="autotagjs-palette-row";
return a.appendChild(b)},A=function(a){var b=document.createElement("span");a&&b.appendChild(la(a));return b},la=function(a){a=a&&a.replace(/ /g,"\u00a0")||"";return document.createTextNode(a)},W=function(){var a=k(),b=a.endContainer;b==a.startContainer&&(V(b)?g(b,0):r(b)?g(b.lastChild,0):l(b)&&(b=b.querySelectorAll("span"),0<b.length&&g((b[a.endOffset-1]||b[b.length-1]).lastChild)))},v=function(a){if("undefined"===typeof a&&n.querySelector("p:first-child")){a=n.childNodes;for(var b=0;b<a.length;b++)"P"!==
a[b].tagName&&D(a[b])}else X(n),a=document.createElement("p"),n.appendChild(a),g(a.appendChild(S()),0)},w=function(a){a="undefined"===typeof a?m():a;if(l(a))if(0===a.textContent.length)X(a),g(a.appendChild(S()),0);else{var b=a;b="undefined"===typeof b?m():b;l(b)&&E(b&&b.querySelectorAll("br"))}return a},H=function(a){if(p&&a){switch(a.autotagjsScope){case "line":var b=Y(p);break;case "selection":b=F(p);var d=Y(p),e;if(!(e=1<d.length)){e=b.length;var c=void 0;c="undefined"===typeof c?m():c;c=l(c)&&
c.getElementsByTagName("span");e=e==c.length}b=e?b.concat(d):b;break;default:b=F(p)}b=b.filter(Boolean);for(var f in a)a.hasOwnProperty(f)&&(d=b,e=f,c=a[f].split(/\s*;\s*/),"autotagjsCommand"==e?P(d,c):"autotagjsCallback"==e?ka(c,d):R(d,e,c));G(p)}},m=function(a){for(a="undefined"===typeof a?k()&&k().endContainer:a;a&&!x(a)&&!l(a);)a=a.parentNode;return l(a)?a:n.querySelector("p:first-child")},Z=function(a){a="undefined"===typeof a?m():a;var b;if(l(a))for(b=1;a=a.previousSibling;)b++;return b},Y=
function(a){var b=m(a.startContainer);a=m(a.endContainer);for(var d=[b];b&&b!==a;)d.push(b=b.nextSibling);return d},B=function(a){if(a&&!x(a)){if(l(a))var b=a.firstChild;else if(r(a)||a&&"DIV"==a.tagName)b=a.nextSibling||B(a.parentNode.nextSibling);b||(b=B(a.parentNode.nextSibling));V(b)&&(b=B(b.parentNode.nextSibling))}return b},k=function(){var a;if("undefined"!=typeof window.getSelection){var b=window.getSelection();b.rangeCount&&(a=b.getRangeAt(0))}else(b=document.selection)&&"Control"!=b.type&&
(a=b.createRange());return a},aa=function(a,b){return a.querySelector("a:nth-child("+("undefined"===typeof b||0>b?0:b)+")")},F=function(a){var b=a.startContainer;b=l(b)&&aa(b,a.startOffset+1)||r(b)&&b||u(b)&&b.parentNode;var d=a.endContainer;a=l(d)&&aa(d,a.endOffset)||r(d)&&d||u(d)&&d.parentNode;for(d=b&&[b]||[];b&&b!==a;)d.push(b=B(b));return d},ba=function(a){l(a)&&g(a.querySelector("a:first-child"),0)},V=function(a){var b;if(b=r(a))b=(a=a.lastChild)&&"BR"==a.tagName;return b},x=function(a){return a&&
a.isSameNode(n)},l=function(a){return a&&"P"==a.tagName},r=function(a){return a&&"SPAN"==a.tagName},u=function(a){return a&&a.nodeType==Node.TEXT_NODE},y=function(a,b){a=null==a?n:a;"undefined"!==typeof b&&E(a.querySelectorAll("div"));if(l(a))for(var d=a.querySelectorAll("span"),e=0;e<d.length;e++){var c=d[e];if(c){var f=parseFloat;var h=c&&window.getComputedStyle(c,null).getPropertyValue("font-size");f=f(h);c.getBoundingClientRect().height>1.3*f&&(c.previousSibling&&"DIV"===c.previousSibling.tagName||
c.parentNode.insertBefore(document.createElement("div"),c))}}},I=function(){t&&(t.style.display="none")},ca=function(a){I();if(a.dataset.autotagjsPalette){var b=a.getElementsByClassName("autotagjs-submenu")[0];if(b)b.style.display="";else{b=document.createElement("div");b.className="autotagjs-submenu autotagjs-palette";a.appendChild(b);for(var d=Math.round(36),e=Math.round(8),c=Math.round(16),f=0,h=100,g=94;5>f;f++,h-=e,g-=c){a=U(b);for(var k=0,l=0;10>k;k++,l+=d)T(a,l,h,g)}a=U(b);c=Math.round(10);
f=0;for(g=10;10>f;f++,g+=c)T(a,0,0,g)}t=b}else if(a.dataset.autotagjsSelect){if(t=a.getElementsByClassName("autotagjs-submenu")[0])b=window.getComputedStyle(t),t.style.display="none"===b.display?"":"none"}else H(a.dataset),y(m(),!0)},J=function(){var a=k(),b=a.endContainer;if(u(b)){a=a.endOffset;var d=b,e=a;e="undefined"===typeof e?0:e;d="undefined"===typeof d?k().endContainer:d;if(u(d)){var c=d.parentNode;if(l(c)){var f=A();c.insertBefore(f,d);f.appendChild(d);g(d,e)}else r(c)&&E(c&&c.querySelectorAll("br"))}var h=
b.parentNode;d=(d=ha(b.nodeValue||""))&&d.filter(Boolean)||"";e=d.length;ea&&console.log("TRACE : splitter : "+d);if(1<e){h.style.display="none";for(f=0;f<e;f++)c=A(d[f]),c.setAttribute("style",h.getAttribute("style")),c.style.display="inline",C(c,c.firstChild.nodeValue),h.parentNode.insertBefore(c,h.nextSibling),h=d[f].length,0<a&&a<=h&&g(c.firstChild,a),a-=h,h=c;D(b.parentNode)}else C(h,h.firstChild.nodeValue)}else r(b)&&u(b.firstChild)&&C(b,b.firstChild.nodeValue)},X=function(a){for(;a&&a.hasChildNodes();)a.removeChild(a.lastChild);
return a},D=function(a){return a&&a.parentNode&&a.parentNode.removeChild(a)},E=function(a){for(var b=0;a&&b<=a.length;b++)D(a[b]);return a},G=function(a){if(a)if(window.getSelection){var b=window.getSelection();0<b.rangeCount&&b.removeAllRanges();b.addRange(a)}else document.createRange?window.getSelection().addRange(a):document.selection&&a.select();return a},K=function(){return p=k()||p},g=function(a,b){b="undefined"===typeof b?a.length:b;return Q(a,b,a,b)},Q=function(a,b,d,e){if(a&&d){b="undefined"===
typeof b?0:b;e="undefined"===typeof e?d.length:e;var c=document.createRange();try{c.setStart(a,b),c.setEnd(d,e),p=c}catch(f){}G(c)}return c};document.addEventListener("selectionchange",L(function(a){K()&&ja(F(p))},500));n.addEventListener("dblclick",function(a){K()});n.addEventListener("click",function(a){I();w();v()});n.addEventListener("focus",function(a){K();v()});n.addEventListener("input",function(){w();J();y(m(),!0)});n.addEventListener("keydown",function(a){M=Z();var b=a.which||a.keyCode||
0;if(8==b)W();else if(13==b)if(O)a.preventDefault(),fa();else{if(a=k())a=a.endContainer,(a=r(a)&&a||u(a)&&a.parentNode)&&(z=a.getAttribute("style"))}else if(9==b){if(a.preventDefault(),b=k(),a=b.endContainer.parentNode,b.startContainer==b.endContainer&&b.startOffset==b.endOffset&&r(a)){var d=b.endOffset,e=a.textContent;b=a.parentNode;var c=a.nextSibling,f=A("    ");0===d?(b.insertBefore(f,a),g(a.firstChild,0)):d===a.firstChild.length?c&&(b.insertBefore(f,c),g(c.firstChild,0)):(a.textContent=e.substring(0,
d),b.insertBefore(f,c),a=A(e.substring(d)),b.insertBefore(a,f.nextSibling),g(a.firstChild,0));y(m(),!0)}}else!a.metaKey||66!=b&&73!=b&&85!=b||(a.preventDefault(),H({autotagjsToggle:da[b]}))});n.addEventListener("keyup",function(a){a=a.which||a.keyCode||0;if(8==a)x(k().endContainer)?v():w(),y(m(),!0);else if(13==a&&!1===O){a=m();if(Z(a)==M)a="undefined"===typeof a?m():a,a=l(a)&&a.nextSibling,null!==a&&(w(a),ba(a));else{var b=a;b="undefined"===typeof b?m():b;b=l(b)&&b.previousSibling;w(b);w(a);ba(a)}v();
J();W()}ia()});n.addEventListener("paste",function(a){a.preventDefault();var b;a.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));a=k().endContainer;x(a)&&(v(!0),a=k().endContainer);u(a)?(a.nodeValue+=b,g(a)):(b=document.createTextNode(b),a.insertBefore(b,a.firstChild),g(b));J()});window.addEventListener("resize",L(function(a){y(m(),!0)},250));v();return{attachMenubar:function(a){a&&(N=a,N.addEventListener("click",
function(a){G(p);a=a.target;if(a.classList.contains("autotagjs-menu")||a.parentNode.classList.contains("autotagjs-submenu"))ca(a);else if(a.parentNode.classList.contains("autotagjs-menu"))ca(a.parentNode);else if(a.classList.contains("autotagjs-palette-cell")){a=a.style.backgroundColor;var b=t.parentNode.dataset,e;"color"==b.autotagjsPalette?e="color: "+a:"fill"==b.autotagjsPalette&&(e="background-color: "+a);b.autotagjsSet=e;H(b);I()}}))}}}}();